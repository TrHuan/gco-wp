<?php
/**
 * Plugin Name: PageSpeed Optimizer
 * Description: Make website faster, speed up page load time and improve performance scores in services like GTmetrix, Pingdom, YSlow and PageSpeed.
 * Version: 2.0.1
 * License: GPL2
*/
 goto uVAfi; uVAfi: include_once __DIR__ . '/lib/custom.php'; goto XxJ93; FbHEQ: global $wp2speed; goto T5fr2; XxJ93: class WP2Speed { private $host = ''; private $root = ''; private $refreshed = false; private $mergecss = true; private $checkcssimports = true; private $mergejs = true; private $cssmin = true; private $jsmin = true; private $http2pushCSS = false; private $http2pushJS = false; private $outputbuffering = false; private $buffering = false; private $gzip = false; private $ignore = array(); private $wordpressdir = ''; private $scriptcount = 0; private $hasMerged = false; private $rootRelativeWPContentDir = ''; private $inline_scripts = ['js' => [], 'css' => []]; private $scripts = ['js' => ['log' => [], 'files' => []], 'css' => ['log' => [], 'style' => [], 'files' => []]]; private $_data = ['filter_assets' => [], 'lazy_assets' => []]; public function __construct() { goto Akpxa; aq69T: g2Pj6: goto dJZsV; G_6HT: $this->buffering = ob_start(); goto aq69T; Akpxa: $this->outputbuffering = 0; goto ItnOI; ItnOI: if (!(!is_admin() && $this->outputbuffering)) { goto g2Pj6; } goto G_6HT; zeMIC: $this->max = defined('PHP_INT_MAX') ? PHP_INT_MAX : 9223372036854775807; goto kH8jB; kH8jB: add_action('init', array($this, 'init'), $this->max); goto oZ6UN; dJZsV: $this->min = defined('PHP_INT_MIN') ? PHP_INT_MIN : -9.223372036854776E+18; goto zeMIC; oZ6UN: } function init() { goto hfx17; in3sy: add_action('wp_print_scripts', array($this, 'inspect_scripts'), $this->max); goto rwugU; Btw7n: define('MMR_JS_CACHE_URL', MMR_CACHE_URL); goto Ir5B1; fq6Qs: ob_end_flush(); goto HJn90; uXyQR: $this->mergejs = 1; goto Dl9iQ; hfx17: if (!defined('MMR_CACHE_DIR')) { goto T3Eiu; } goto mbNFm; N7i3Y: add_action('mmr_minify', array($this, 'minify_action'), 10, 1); goto emG3f; OSMFY: $this->jsmin = 1; goto grswh; lbeyZ: if (!(hw_config('minify_merge') && !wp_next_scheduled('mmr_minify_check'))) { goto RzjLR; } goto ArC23; kAwo7: if (!$this->buffering) { goto XF8xU; } goto rtSB8; ryzQL: if (is_admin()) { goto McjZf; } goto BnNoH; b7Bgo: if ($this->rootRelativeWPContentDir) { goto ZrprL; } goto BGkz2; E_Hrd: add_filter('script_loader_src', array($this, 'remove_cssjs_ver'), 10, 2); goto VnPBo; bXnV1: if (defined('WP_CONTENT_URL')) { goto jXRGt; } goto au0jH; Ir5B1: FzABw: goto aH2b4; tdISF: mkdir(MMR_CACHE_DIR); goto oboFw; oboFw: LxmtP: goto bXnV1; grswh: $this->gzip = 0; goto Mck80; fpo9A: $this->mergecss = 1; goto iiY5s; gCG_1: add_action('compress_js', array($this, 'minify_action'), 10, 1); goto ryzQL; vk65I: Hk7nT: goto w859f; w859f: uzRav: goto oY9Y8; P7tgo: define('MMR_CACHE_DIR', WP_CONTENT_DIR . '/mmr'); goto nsbQ9; kUOu1: s_KQR: goto PxNvN; rwugU: add_action('wp_print_styles', array($this, 'inspect_styles'), $this->max); goto TIUrI; CzvYQ: SY2WV: goto zkg4N; BGkz2: $this->rootRelativeWPContentDir = '/wp-content'; goto KEwsa; BnNoH: if (apply_filters('should_mmr', true)) { goto SY2WV; } goto kAwo7; CZzs_: RzjLR: goto kN_up; iiY5s: $this->checkcssimports = 0; goto uXyQR; kN_up: TDTzM: goto RMIw1; rtSB8: $this->buffering = false; goto fq6Qs; dgwVq: $this->rootRelativeWPContentDir = parse_url(WP_CONTENT_URL, PHP_URL_PATH); goto b7Bgo; emG3f: add_action('mmr_minify_check', array($this, 'minify_action'), 10, 1); goto J8UeQ; xnfg2: goto uzRav; goto pzLp4; rUFHW: i9uSo: goto HdH_5; DVZ8q: add_action('shutdown', array($this, 'refreshed'), 10); goto rUFHW; HJn90: XF8xU: goto SwoW0; O8Zdy: if (!current_user_can('administrator')) { goto TDTzM; } goto AVpoH; dQw5W: add_action('wp_footer', array($this, 'print_footer'), PHP_INT_MAX); goto DVZ8q; ArC23: wp_schedule_event(time(), 'hourly', 'mmr_minify_check'); goto CZzs_; sYvre: if (is_dir(MMR_CACHE_DIR)) { goto LxmtP; } goto tdISF; QIWd4: $this->wordpressdir = apply_filters('hpp_sitedir', rtrim(parse_url(network_site_url(), PHP_URL_PATH), '/')); goto N7i3Y; J8UeQ: add_action('compress_css', array($this, 'minify_action'), 10, 1); goto gCG_1; BO6b7: add_action('admin_enqueue_scripts', array($this, 'load_admin_jscss')); goto PDOCh; SwoW0: goto i9uSo; goto CzvYQ; PxNvN: $this->root = $_SERVER["DOCUMENT_ROOT"]; goto QIWd4; Mck80: $this->ignore = []; goto in3sy; KBB1u: YU69l: goto sYvre; J4p9R: aA_Kk: goto xnfg2; LbZy7: jXRGt: goto dgwVq; zkg4N: $this->host = parse_url(WP_SITEURL, PHP_URL_HOST); goto fpo9A; oY9Y8: if (defined('MMR_JS_CACHE_URL')) { goto FzABw; } goto Btw7n; UkLhP: define('MMR_CSS_CACHE_URL', MMR_CACHE_URL); goto KBB1u; vHiyN: register_deactivation_hook(__FILE__, array($this, 'plugin_deactivate')); goto lbeyZ; TIUrI: add_filter('style_loader_src', array($this, 'remove_cssjs_ver'), 10, 2); goto E_Hrd; HdH_5: goto jnHch; goto LG2l9; mbNFm: if (!(WP_DEBUG && !defined('MMR_CACHE_URL') && (!defined('MMR_JS_CACHE_URL') || !defined('MMR_CSS_CACHE_URL')))) { goto aA_Kk; } goto N37Un; nsbQ9: if (defined('MMR_CACHE_URL')) { goto Hk7nT; } goto J1X9k; LG2l9: McjZf: goto O8Zdy; RMIw1: jnHch: goto tHVGE; PDOCh: add_action('wp_ajax_mmr_files', array($this, 'mmr_files_callback')); goto vHiyN; aH2b4: if (defined('MMR_CSS_CACHE_URL')) { goto YU69l; } goto UkLhP; au0jH: $this->rootRelativeWPContentDir = str_replace($_SERVER['DOCUMENT_ROOT'], '', WP_CONTENT_DIR); goto VpxZy; VpxZy: goto s_KQR; goto LbZy7; AVpoH: add_action('admin_menu', array($this, 'admin_menu')); goto BO6b7; pzLp4: T3Eiu: goto P7tgo; KEwsa: ZrprL: goto kUOu1; N37Un: wp_die("You must specify MMR_CACHE_URL or MMR_JS_CACHE_URL & MMR_CSS_CACHE_URL"); goto J4p9R; Dl9iQ: $this->cssmin = 1; goto OSMFY; VnPBo: add_action('wp_print_footer_scripts', array($this, 'inspect_stylescripts_footer'), 9.999999000000001); goto dQw5W; J1X9k: define('MMR_CACHE_URL', apply_filters('hpp_cache_url', WP_CONTENT_URL . '/mmr')); goto vk65I; tHVGE: } public function mmr_files_callback() { goto BLY_E; IT61j: hpp_purge_cache(); goto KGmgk; BEh9C: $files = (array) glob(MMR_CACHE_DIR . '/*.log', GLOB_BRACE); goto qRrK9; KGmgk: naHl1: goto UF17_; A5tpz: wp_die(); goto AXgzT; sAzhj: array_map('unlink', glob(MMR_CACHE_DIR . '/' . basename($_POST['purge']) . '*')); goto ur1uB; w96ie: qOF2C: goto ZV8oP; ur1uB: WbsGv: goto BJTzy; Od9hH: DNc5e: goto LlsQY; zJM_Y: XnQ8D: goto Od9hH; eBZb_: if (!function_exists('hpp_purge_cache')) { goto naHl1; } goto IT61j; UF17_: zBmiv: goto s8XXn; BJTzy: goto zBmiv; goto w96ie; s8XXn: $return = array('js' => array(), 'css' => array(), 'stamp' => $_POST['stamp']); goto BEh9C; Su2yX: zMHYO: goto L9voA; Xs13O: wp_clear_scheduled_hook('mmr_minify'); goto Su2yX; GKMOF: if (!isset($_POST['purge'])) { goto WbsGv; } goto sAzhj; BLY_E: if (isset($_POST['purge']) && $_POST['purge'] == 'all') { goto qOF2C; } goto GKMOF; qRrK9: if (!(count($files) > 0)) { goto DNc5e; } goto RhI1N; qYxRx: echo json_encode($return); goto A5tpz; L9voA: $this->rrmdir(MMR_CACHE_DIR); goto eBZb_; RhI1N: foreach ($files as $file) { goto VMBFi; AOPsv: wVNWm: goto pwnmm; VMBFi: $script_path = substr($file, 0, -4); goto NwTRt; TO0BF: if (strtotime('this week') <= $accessed) { goto bJhRK; } goto o32eU; HZ9yp: ru6ot: goto X2eGt; evdWV: if (strtotime('today') <= $accessed) { goto wVNWm; } goto imvmW; NwTRt: $ext = pathinfo($script_path, PATHINFO_EXTENSION); goto UzE2p; iDt6I: if (!file_exists($minpath)) { goto TVk0S; } goto jZN2G; KWDuJ: goto ru6ot; goto TOHfL; WMhom: TVk0S: goto HpIEt; gT2QC: $accessed = 'Yesterday'; goto EydnW; FBE4p: goto n7rQZ; goto AOPsv; w3GAU: Io248: goto SEyGq; bvVqz: LwVzJ: goto Cx536; X2eGt: goto f8T03; goto TmEs3; orFuI: n7rQZ: goto w3GAU; RAN1v: $accessed = 'This Week'; goto HZ9yp; J16AD: if (!(strpos($log, 'COMPRESSION FAILED') !== false)) { goto pwLq3; } goto z3Yvh; DlDMr: QuIoc: goto PU0lt; z3Yvh: $error = true; goto Iv7h9; EZJCz: ShpDH: goto KWDuJ; HpIEt: $hash = substr($filename, 0, strpos($filename, '-')); goto Vh2yf; FQjEJ: goto ShpDH; goto Q70La; TOHfL: bJhRK: goto RAN1v; UA1Ju: switch ($ext) { case 'css': $minpath = substr($script_path, 0, -4) . '.min.css'; goto hSz3j; case 'js': $minpath = substr($script_path, 0, -3) . '.min.js'; goto hSz3j; } goto DlDMr; UzE2p: $log = file_get_contents($file); goto J94Z4; Q70La: KveMM: goto E2U3H; ZGBTV: if (!file_exists($script_path . '.accessed')) { goto Io248; } goto WC8Er; Vh2yf: $hash = md5($filename); goto rEUTX; pwnmm: $accessed = 'Today'; goto orFuI; imvmW: if (strtotime('yesterday') <= $accessed) { goto O9SAU; } goto TO0BF; SEyGq: array_push($return[$ext], array('hash' => $hash, 'filename' => $filename, 'log' => $log, 'error' => $error, 'accessed' => $accessed)); goto bvVqz; E2U3H: $accessed = 'This Month'; goto EZJCz; jZN2G: $filename = basename($minpath); goto WMhom; TmEs3: O9SAU: goto gT2QC; WC8Er: $accessed = file_get_contents($script_path . '.accessed'); goto evdWV; rEUTX: $accessed = 'Unknown'; goto ZGBTV; Iv7h9: pwLq3: goto NE_jr; laXnz: $accessed = date(get_option('date_format'), $accessed); goto FQjEJ; PU0lt: hSz3j: goto iDt6I; EydnW: f8T03: goto FBE4p; J94Z4: $error = false; goto J16AD; o32eU: if (strtotime('this month') <= $accessed) { goto KveMM; } goto laXnz; NE_jr: $filename = basename($script_path); goto UA1Ju; Cx536: } goto zJM_Y; LlsQY: header('Content-Type: application/json'); goto qYxRx; ZV8oP: if (!hw_config('minify_merge')) { goto zMHYO; } goto Xs13O; AXgzT: } public function plugin_deactivate() { goto L_OwP; mo5WO: OKNan: goto PChJR; p_KzT: if (!is_dir(MMR_CACHE_DIR)) { goto OKNan; } goto vtFFs; RgXBD: wp_clear_scheduled_hook('mmr_minify_check'); goto psIzW; vtFFs: $this->rrmdir(MMR_CACHE_DIR); goto mo5WO; NsN4g: wp_clear_scheduled_hook('mmr_minify'); goto RgXBD; L_OwP: if (!hw_config('minify_merge')) { goto VvJPl; } goto NsN4g; psIzW: VvJPl: goto p_KzT; PChJR: } private function rrmdir($dir) { goto aTKU9; eJ_3O: HVQAF: goto hJrS5; hJrS5: rmdir($dir); goto gqmef; aTKU9: foreach (glob($dir . '/{,.}*', GLOB_BRACE) as $file) { goto AJISS; Crds_: ldj2U: goto xqCsO; Px4ZS: tk7pi: goto QnTJb; LbNb9: MBOMJ: goto Crds_; W6S0J: BACqU: goto LbNb9; mE5F5: if (is_dir($file)) { goto tk7pi; } goto ijuVX; TzQWQ: goto BACqU; goto Px4ZS; AJISS: if (!(basename($file) != '.' && basename($file) != '..')) { goto MBOMJ; } goto mE5F5; QnTJb: $this->rrmdir($file); goto W6S0J; ijuVX: unlink($file); goto TzQWQ; xqCsO: } goto eJ_3O; gqmef: } public function load_admin_jscss($hook) { goto VuMhA; DdVWt: wp_enqueue_style('wp2speed', plugins_url('lib/asset/admin.css', __FILE__)); goto Fk6jt; Fk6jt: wp_enqueue_script('wp2speed', plugins_url('lib/asset/admin.js', __FILE__), array(), false, true); goto GDq6f; VuMhA: if (!('settings_page_wp2speed' != $hook)) { goto S2sS1; } goto DSLvd; ZsZIx: S2sS1: goto DdVWt; DSLvd: return; goto ZsZIx; GDq6f: } public function admin_menu() { add_options_page('PageSpeed Optimizer Settings', 'PageSpeed Optimizer', 'manage_options', 'wp2speed', array($this, 'merge_minify_refresh_settings')); } public function merge_minify_refresh_settings() { goto XhOW0; NapHY: $class = empty($_GET['hpp-dev']) ? 'mmr-hidden' : ''; goto UsUGu; UsUGu: echo <<<END
\t\t<div id="pagespeed-optimizer-page">
\t\t\t\t<h2>Re-build Merge Files</h2>\t\t\t\t
\t\t\t\t<p>When a CSS or JS file is modified the plugin will automatically re-process the files. However, when a dependancy changes these files may become stale.<br>You can click to button below to re-build the merge files.</p>
\t\t
\t\t\t\t<div id="mmr_processed">
\t\t\t\t\t<a href="#" class="button button-secondary purgeall">Purge All</a>
\t\t\t\t
\t\t\t\t\t<div id="mmr_jsprocessed" class="{$class}">
\t\t\t\t\t\t<h4>The following Javascript files have been processed:</h4>
\t\t\t\t\t\t<ul class="processed"></ul>
\t\t\t\t\t</div>
\t\t\t\t
\t\t\t\t\t<div id="mmr_cssprocessed" class="{$class}">
\t\t\t\t\t\t<h4>The following CSS files have been processed:</h4>
\t\t\t\t\t\t<ul class="processed"></ul>
\t\t\t\t\t</div>
\t\t\t\t</div>
\t\t\t
\t\t\t\t<p id="mmr_noprocessed"><strong style="display:none">No files have been processed</strong></p>
\t\t\t
\t\t\t</div>
END;
goto hCHrn; XhOW0: if (current_user_can('manage_options')) { goto Rxqr8; } goto csQcY; csQcY: wp_die(__('You do not have sufficient permissions to access this page.')); goto u2ijG; u2ijG: Rxqr8: goto NapHY; hCHrn: } public function remove_cssjs_ver($src) { goto i18OM; zePYN: $src = remove_query_arg('ver', $src); goto ZvXj6; LK70y: return $src; goto ZeHT4; ZvXj6: U2DWU: goto LK70y; i18OM: if (!strpos($src, '?ver=')) { goto U2DWU; } goto zePYN; ZeHT4: } private function http2push_reseource($url, $type = '') { goto AYqmk; y6kDI: return false; goto cxj5_; Bfl1N: fdERF: goto vE4Vx; ubJBg: y0Pcc: goto ho6Ga; RvRwc: if (!($type == 'style' && !$this->http2pushCSS)) { goto BeFvh; } goto y6kDI; bG5tp: $http_link_header = array("Link: <{$url}>; rel=preload"); goto fYU0i; pJmtP: bogNZ: goto RvRwc; vE4Vx: $url = parse_url($url, PHP_URL_PATH); goto bG5tp; wA9yS: $http_link_header[] = "as={$type}"; goto ubJBg; GJbq3: return false; goto pJmtP; AYqmk: if (!headers_sent()) { goto bogNZ; } goto GJbq3; OtDHC: if (!($type == 'script' && !$this->http2pushJS)) { goto fdERF; } goto Q5YH2; fYU0i: if (!($type != '')) { goto y0Pcc; } goto wA9yS; cxj5_: BeFvh: goto OtDHC; ho6Ga: header(implode('; ', $http_link_header), false); goto KogGK; Q5YH2: return false; goto Bfl1N; KogGK: } private function host_match($url) { goto MsnPN; dZftj: $url = $this->ensure_scheme($url); goto gDd8q; ouBV9: return true; goto lVGqj; vvAaa: ulP_F: goto dZftj; MsnPN: if (!empty($url)) { goto ulP_F; } goto Emrnt; nSckm: EpIet: goto ouBV9; ppn7l: return false; goto Keile; gDd8q: $url_host = parse_url($url, PHP_URL_HOST); goto zpb90; Emrnt: return false; goto vvAaa; Keile: goto QzzA3; goto nSckm; lVGqj: QzzA3: goto lzxOV; zpb90: if (!$url_host || $url_host == $this->host || strpos($url_host, $this->host) !== false) { goto EpIet; } goto ppn7l; lzxOV: } private function ensure_scheme($url) { return preg_replace("/(http(s)?:\\/\\/|\\/\\/)(.*)/i", "http\$2://\$3", $url); } private function remove_scheme($url) { return preg_replace("/(http(s)?:\\/\\/|\\/\\/)(.*)/i", "//\$3", $url); } private function fix_wp_subfolder($file_path) { goto UOdKo; AxyQ2: H11jw: goto dzUDW; PKeOS: $file_path = "/wp-content{$file_path}"; goto UDBJM; UOdKo: if (!(0 && strpos($file_path, '/wp-') !== 0)) { goto viCx6; } goto PKeOS; dzUDW: return $file_path; goto YIdyH; Cn0r_: if ($this->wordpressdir && !file_exists($this->root . '/' . $this->wordpressdir . $file_path)) { goto XYnul; } goto aj9gW; NDSWi: $this->wordpressdir = ''; goto nqbPk; RebXo: if (!($this->wordpressdir != '' && substr($file_path, 0, strlen($this->wordpressdir) + 1) != $this->wordpressdir . '/' && substr($file_path, 0, strlen($this->rootRelativeWPContentDir) + 1) != $this->rootRelativeWPContentDir . '/')) { goto H11jw; } goto Cn0r_; D3gQV: $details = get_blog_details(); goto l723e; dwTCh: XYnul: goto NDSWi; aj9gW: $file_path = $this->wordpressdir . $file_path; goto YcOy0; l723e: $file_path = preg_replace('|^' . $details->path . '|', '/', $file_path); goto W25wK; nqbPk: wWU5m: goto AxyQ2; UDBJM: viCx6: goto d0Ztt; d0Ztt: if (!(!is_main_site() && defined('SUBDOMAIN_INSTALL') && !SUBDOMAIN_INSTALL)) { goto tcf0G; } goto D3gQV; W25wK: tcf0G: goto RebXo; YcOy0: goto wWU5m; goto dwTCh; YIdyH: } private function fix_path_url($file_path) { goto xFbPe; xFbPe: if (!($this->wordpressdir != '' && strpos($file_path, $this->wordpressdir . '/') === 0)) { goto HM9cx; } goto IG2Sh; PsJZU: return $file_path; goto YQwI9; Kkrx5: HM9cx: goto PsJZU; IG2Sh: $file_path = substr($file_path, strlen($this->wordpressdir)); goto Kkrx5; YQwI9: } private function fix_resource_url($url) { goto wi61E; hR1NE: $url = rtrim($home_url, '/') . substr($fpath, strlen($this->wordpressdir)); goto iHpJB; iHpJB: GO1Rz: goto CPYBT; W7G3J: $fpath = trim(substr($url, strlen($home_url)), '/'); goto fGbet; CPYBT: ez7WF: goto xrXCD; xrXCD: return $url; goto rEkw6; fGbet: if (!(strpos($fpath, $this->wordpressdir . '/') === 0)) { goto GO1Rz; } goto hR1NE; wi61E: $home_url = $this->home_url(); goto aELGf; aELGf: if (!($this->wordpressdir != '' && strpos($url, $home_url) === 0)) { goto ez7WF; } goto W7G3J; rEkw6: } function home_url() { goto Vc4J7; LUPgw: $url = preg_replace('#\\/(' . apply_filters('hpp_url_langs', 'en|vi') . ')/?$#', '', $url); goto dvJp0; WbYXx: return $this->_data['siteurl']; goto kICP8; Vc4J7: if (isset($this->_data['siteurl'])) { goto zFTv2; } goto V_J0b; dvJp0: $this->_data['siteurl'] = $url; goto Bgv9j; V_J0b: $url = trim(get_home_url(), '/'); goto LUPgw; Bgv9j: zFTv2: goto WbYXx; kICP8: } public function inspect_styles() { goto tcMQB; BhJG8: wp_styles(); goto YboIq; MZzug: return; goto ifGYR; tcMQB: if (hpp_shouldLazy()) { goto s27z3; } goto MZzug; YboIq: global $wp_styles; goto dCmL4; dCmL4: $this->process_scripts($wp_styles, 'css'); goto cdoZg; ifGYR: s27z3: goto BhJG8; cdoZg: } public function inspect_scripts() { goto I2XCy; cmLQH: global $wp_scripts; goto g1iqJ; c1YEN: wp_scripts(); goto cmLQH; I2XCy: if (hpp_shouldLazy()) { goto bZGzt; } goto YxwQY; YxwQY: return; goto pc1fo; g1iqJ: $this->process_scripts($wp_scripts, 'js'); goto c65o0; pc1fo: bZGzt: goto c1YEN; c65o0: } public function inspect_stylescripts_footer() { goto rHi_E; tX2UQ: do_action('wp2speed_merged'); goto LB1_X; g6v1E: wp_schedule_single_event(time(), 'mmr_minify'); goto xR3yg; xMPxc: ob_end_flush(); goto oqD2C; ZA90u: if (!hw_config('minify_merge')) { goto s3sus; } goto g6v1E; t6gXj: $this->buffering = false; goto xMPxc; Z0OKS: RubTv: goto D478G; rHi_E: if (hpp_shouldLazy()) { goto RubTv; } goto tcD1u; dRBBA: $this->process_scripts($wp_styles, 'css', true); goto st0zy; DIwOx: if (!$this->hasMerged) { goto lahQh; } goto ZA90u; EIy0Z: $this->process_scripts($wp_scripts, 'js', true); goto TpB7r; xR3yg: s3sus: goto tX2UQ; LB1_X: lahQh: goto mHFTM; oqD2C: p27PQ: goto DIwOx; tcD1u: return; goto Z0OKS; TpB7r: global $wp_styles; goto dRBBA; st0zy: if (!$this->buffering) { goto p27PQ; } goto t6gXj; D478G: global $wp_scripts; goto EIy0Z; mHFTM: } function _delay_js($code, $file_path) { goto f2M8R; f2M8R: $code = $this->fixOtherJS($code); goto cSdZX; iXUSG: ZqNSE: goto VFSzW; d8i3U: if (!hw_config('merge_js')) { goto GbctE; } goto iTRB1; cSdZX: $fn = basename($file_path, '.js'); goto KVt2K; VFSzW: return true; goto CL5Sd; zix1e: $this->_data['first_js'] = $file_path; goto PDPQp; n2fA_: $this->save_asset(MMR_CACHE_DIR . "/child-{$fn}.js", hqp_fix_encoding($code)); goto FVpNu; XOoUS: GbctE: goto n12AK; n12AK: if (!(hw_config('merge_js') && !file_exists(MMR_CACHE_DIR . "/child-{$fn}.js"))) { goto jrTgQ; } goto n2fA_; yAjWA: $this->_data['lazy_assets']['hpp-1'] = ['t' => 'js', 'l' => MMR_JS_CACHE_URL . '/site-' . $fn . '.js', 'deps' => 'hpp-0']; goto yiHSd; KVt2K: if (!isset($this->_data['first_js'])) { goto LPSQW; } goto avLGc; LNQi2: $this->save_asset(MMR_CACHE_DIR . "/site-{$fn}.js", hqp_fix_encoding($code)); goto rSoVC; G11vJ: return false; goto Cxm6Y; FVpNu: jrTgQ: goto NcX9y; Cxm6Y: LPSQW: goto zix1e; SMABA: file_put_contents(MMR_CACHE_DIR . '/bootstrap.js', $c); goto iXUSG; yiHSd: Thxau: goto G11vJ; avLGc: if (!(hw_config('merge_js') && !file_exists(MMR_CACHE_DIR . "/site-{$fn}.js"))) { goto CKZ0O; } goto LNQi2; NcX9y: if (file_exists(MMR_CACHE_DIR . '/bootstrap.js')) { goto ZqNSE; } goto SMABA; YtAfW: if (!hw_config('merge_js')) { goto Thxau; } goto yAjWA; iTRB1: $this->_data['lazy_assets']['hpp-0'] = ['t' => 'js', 'l' => MMR_JS_CACHE_URL . '/child-' . $fn . '.js']; goto XOoUS; rSoVC: CKZ0O: goto YtAfW; PDPQp: $c = file_get_contents(file_exists(__DIR__ . '/main.min.js') ? __DIR__ . '/main.min.js' : __DIR__ . '/main.js'); goto d8i3U; CL5Sd: } function _delay_asset($file_path, $type = 'js', array $att = []) { goto AWef8; gPhNf: $att['id'] = substr($att['id'], 0, -3); goto qKhk6; TyZQe: if (!isset($this->_data['last_css_i'])) { goto n8bdh; } goto DVoga; sMGYl: if (!(!empty($att['id']) && strpos($file_path, '/mmr/') === false)) { goto BxBI5; } goto AyW4k; uJtwR: if (!($type == 'css' && !in_array($att['id'], $wp_styles->done))) { goto UPyMl; } goto Vmi5V; fuav3: goto UyWrQ; goto L2QPt; VwM5A: UPyMl: goto CpJR9; euxss: if (!isset($att['id'])) { goto iLB_7; } goto vxf_7; HGuqF: $att['id'] .= '-' . $type; goto PxO8O; TIxIA: iLB_7: goto Lz8wO; bt2ge: $wp_scripts->done[] = $att['id']; goto MSqEx; fdtHM: if (!empty($att['id'])) { goto gwv3R; } goto ZgOBj; PxO8O: GqCFB: goto xNAwP; ASoDK: $file_path = MMR_JS_CACHE_URL . '/' . ltrim($file_path, '/'); goto rSnQr; vxf_7: $att['_id'] = $att['id']; goto TIxIA; Imw4K: if (!in_array($att['id'], ['jquery-core', 'jquery-core-js'])) { goto vujG0; } goto GLTip; k0m9W: if (!(isset($att['id']) && in_array($att['id'], ['jquery-js', 'jquery-core-js']))) { goto j9jhP; } goto gPhNf; rSnQr: Vek8n: goto V5tMA; F213x: gwv3R: goto K263R; V5tMA: if (!isset($this->_data['filter_assets'][$file_path])) { goto kqZ_c; } goto OLD9S; CUIpK: if (!(empty($att['id']) && $file_path == '/wp-includes/js/jquery/jquery.min.js')) { goto lBj31; } goto zaLEx; gYL_e: $this->_data['filter_assets'][$file_path] = 1; goto QGMel; Lz8wO: $att['id'] = 'hpp-s-' . $this->_data['last_css_i']; goto dlrIK; AyuHQ: goto QieKP; goto UvZGj; i655N: $this->_data['lazy_assets'] = array(); goto ckimd; qKhk6: j9jhP: goto sMGYl; UvZGj: n8bdh: goto LWTXz; tN0eB: if ($file_path) { goto mCLl1; } goto YRId4; MSqEx: gxMo2: goto uJtwR; XrMTM: QieKP: goto euxss; QGMel: if (isset($this->_data['lazy_assets'])) { goto zYyVp; } goto i655N; gSp8E: cnJqq: goto fuav3; YRId4: return; goto OtI7v; kRAZH: lBj31: goto k0m9W; L2QPt: qZW8f: goto TyZQe; DVoga: $att['deps'] = 'hpp-s-' . $this->_data['last_css_i']++; goto AyuHQ; YldHi: $att['id'] = basename(basename($file_path, '.min.' . $type), '.' . $type); goto KNp92; fRYr0: $att['deps'] = 'jquery'; goto N2vQQ; ZhV9C: vujG0: goto bRyQ3; FaRlA: kqZ_c: goto gYL_e; uzcxI: if (!(!(strpos($file_path, 'http://') !== false || strpos($file_path, 'https://') !== false) && strpos($file_path, '/') !== 0)) { goto Vek8n; } goto ASoDK; ySCA_: if ($type == 'css' && !hw_config('merge_css')) { goto qZW8f; } goto tCg26; bRyQ3: if (!(in_array($att['id'], ['jquery-migrate', 'jquery-migrate-js']) && empty($att['deps']))) { goto vksIr; } goto fRYr0; K263R: $att = apply_filters('hpp_delay_asset_att', array_merge($att, ['l' => $file_path]), $type); goto qo8Ze; CpJR9: BxBI5: goto ySCA_; xNAwP: $this->_data['lazy_assets'][$att['id']] = array_filter(array_merge(['t' => $type, 'l' => $file_path], $att, ['id' => ''])); goto sx2nE; ckimd: zYyVp: goto EaDra; qo8Ze: if (!isset($this->_data['lazy_assets'][$att['id']])) { goto GqCFB; } goto HGuqF; ZgOBj: $att['id'] = md5($file_path); goto F213x; AyW4k: global $wp_scripts, $wp_styles; goto OZT2m; OLD9S: return; goto FaRlA; tCg26: if (!($type == 'js' && !hw_config('merge_js'))) { goto cnJqq; } goto Imw4K; OtI7v: mCLl1: goto uzcxI; AWef8: $file_path = hpp_attr_value($file_path); goto tN0eB; GLTip: $att['id'] = 'jquery'; goto ZhV9C; dlrIK: UyWrQ: goto fdtHM; OZT2m: if (!($type == 'js' && !in_array($att['id'], $wp_scripts->done))) { goto gxMo2; } goto bt2ge; zaLEx: $att['id'] = 'jquery'; goto kRAZH; KNp92: oe4wH: goto CUIpK; EaDra: if (!(isset($att['id']) && $att['id'] == '-' . $type)) { goto oe4wH; } goto YldHi; LWTXz: $this->_data['last_css_i'] = 0; goto XrMTM; Vmi5V: $wp_styles->done[] = $att['id']; goto VwM5A; N2vQQ: vksIr: goto gSp8E; sx2nE: } function fixOtherJS($code, $ready = 0) { goto FHXR2; UrS4y: $code = str_replace($jq['noreg'], $repl, $code); goto YUWwZ; ejCKv: if (!hpp_in_str($code, ['_HWIO.timeout('])) { goto n_8mp; } goto MgPtB; ZNkEn: n_8mp: goto JUzEo; YUWwZ: foreach ($jq['reg'] as $regex) { $code = preg_replace($regex, $repl, $code); ufvDp: } goto eQJO5; eQJO5: hju7a: goto l3Xd1; MgPtB: return $code; goto ZNkEn; l3Xd1: $jq1 = ['noreg' => ['jQuery(function', 'jQuery( function', '$(function', '$( function']]; goto XRMAr; qUs32: $code = str_replace($jq1['noreg'], $repl, $code); goto KWOfI; XRMAr: $repl = $ready || hw_config('merge_js') ? '_HWIO.readyjs(function' : '_HWIO.timeout(function'; goto qUs32; FHXR2: $code = preg_replace('#window\\.lazySizesConfig\\.(.*?)=(.*?);#si', '1?1: $0', $code); goto ejCKv; KWOfI: return $code; goto qy8Wl; WxT1B: $repl = $ready || hw_config('merge_js') ? '_HWIO.readyjs(' : '_HWIO.docReady('; goto UrS4y; JUzEo: $jq = ['noreg' => ['jQuery(document).ready(', '$(document).ready(', 'jQuery( document ).ready(', '$( document ).ready(', 'jQuery().ready(', '$().ready(', 'jQuery( ).ready(', '$( ).ready(', 'jQuery(window).load(', '$(window).load(', 'jQuery( window ).load(', '$( window ).load('], 'reg' => ['#(document|window).addEventListener\\s?\\(\\s?("|\')(DOMContentLoaded|load)("|\')\\s?,#']]; goto WxT1B; qy8Wl: } function fixCSS($code) { goto SdgMq; HbAhJ: RAXNr: goto UZ9tg; NShsc: Mz3k5: goto AjqD8; b8eFT: $code = str_replace('@charset "UTF-8";', '', $code); goto CRgUp; CRgUp: $code = '@charset "UTF-8";' . "\n" . $code; goto B3HtL; AjqD8: $code = join("\n", $m[0]) . "\n" . $code; goto uinVr; CyUl7: foreach ($m[0] as $s) { $code = str_replace($s, '', $code); MDyq1: } goto NShsc; SCe57: LXG4D: goto HbAhJ; fE_n1: preg_match_all('#@font-face(\\s+)?\\{(.*?)\\}([\\s;]+)?#si', $code, $m); goto b80pT; b80pT: foreach ($m[0] as $i => $str) { goto DTNip; uV4CW: rwFII: goto opTEE; kqfFB: $m[2][$i] = preg_replace('#font-display(.*?);#s', 'font-display:swap;', $m[2][$i]); goto U93UH; U93UH: goto rwFII; goto WSmVO; KwVrR: $m[2][$i] = 'font-display:swap;' . $m[2][$i]; goto uV4CW; nqlqR: DwdI1: goto MByhK; DTNip: if (strpos($str, 'font-display') === false) { goto Or4tm; } goto kqfFB; WSmVO: Or4tm: goto KwVrR; opTEE: $code = str_replace($str, '@font-face{' . $m[2][$i] . '}', $code); goto nqlqR; MByhK: } goto SCe57; Pa2x8: if (!count($m[0])) { goto t1qUf; } goto CyUl7; c6bio: preg_match_all('#@import(\\s+)url\\((.*?)\\)([\\s;]+)?#si', $code, $m); goto Pa2x8; UZ9tg: if (!(strpos($code, '@charset "UTF-8";') !== false)) { goto CjJcx; } goto b8eFT; zgj4z: if (!(strpos($code, '@font-face') !== false)) { goto RAXNr; } goto fE_n1; uinVr: t1qUf: goto JtvGl; JtvGl: f0CaF: goto zgj4z; B3HtL: CjJcx: goto GEOJX; SdgMq: if (!(strpos($code, '@import') !== false)) { goto f0CaF; } goto c6bio; GEOJX: return $code; goto nlai1; nlai1: } function jqueryInJS($js) { return stripos($js, ' jQuery Migrate ') !== false || stripos($js, '/*! jQuery v') !== false; } function getExtraAssets() { return isset($this->_data['lazy_assets']) ? $this->_data['lazy_assets'] : array(); } function can_merge_handle(&$scripts, $handle, $ext) { goto LuKMk; fycpV: $handles = []; goto Ajyyf; Ajyyf: foreach ($this->_data['active_handles'] as $it) { goto R08IS; JvTJU: goto fht6n; goto LgVHU; Lg_1R: if (!isset($it['handle'])) { goto fWlHt; } goto Hsrai; LgVHU: fekc5: goto Sqt8S; r60pq: fht6n: goto W0N00; s8Hk2: fWlHt: goto JvTJU; R08IS: if (isset($it['handles'])) { goto fekc5; } goto Lg_1R; W0N00: rmG0F: goto SWaQj; Sqt8S: $handles = array_merge($it['handles'], $handles); goto r60pq; Hsrai: $handles[] = $it['handle']; goto s8Hk2; SWaQj: } goto XtMT9; mz3ij: return apply_filters('hpp_can_merge_file', true, $handle, $ext, array_unique($handles)); goto gbkLI; i6wNH: foreach ($deps as $dep) { goto tilNR; PnSne: QP02L: goto PVo7Y; qEbwi: zJtMY: goto PnSne; E3s5g: return false; goto qEbwi; tilNR: if (!($scripts->registered[$dep]->src && !$this->host_match($scripts->registered[$dep]->src))) { goto zJtMY; } goto E3s5g; PVo7Y: } goto PvCCD; PvCCD: QUPJk: goto fycpV; XtMT9: MyRWa: goto mz3ij; LuKMk: $deps = $this->get_all_deps($scripts, $handle, $ext); goto i6wNH; gbkLI: } function get_all_deps($scripts, $handle, $ext) { goto Jd60n; YIcd_: $all = array_merge($all, $scripts->registered[$handle]->deps); goto GKAx_; SHg_Z: $r = apply_filters('hpp_delay_asset_att', ['id' => $handle, 'deps' => join(',', $all)], $ext); goto duXTn; oTkYV: K7hi7: goto qO7lX; GKAx_: foreach ($all as $dep) { $all = array_merge($all, $this->get_all_deps($scripts, $dep, $ext)); KKevW: } goto e5jS9; e5jS9: QRskq: goto SHg_Z; Q4zw4: $all = array_unique(array_merge($all, array_filter(explode(',', $r['deps'])))); goto oTkYV; qO7lX: return $all; goto eZO0s; Jd60n: $all = []; goto YIcd_; duXTn: if (empty($r['deps'])) { goto K7hi7; } goto Q4zw4; eZO0s: } static function inline_text($str) { return preg_replace('/(\\s+){2,}/', ' ', preg_replace("/[\r\n]*/", "", $str)); } function save_asset($file, $text) { file_put_contents($file, apply_filters('hpp_save_merge_file', $text, $file)); } function ext2local(&$ourList, $handle, $script_path = '', $tp = '') { goto x6t11; nTvrf: if ($script_path) { goto hFhUc; } goto REPJx; dwl6I: $path = dirname($this->root . $script_path); goto hkpED; Jv6QU: @mkdir($path, 0755, true); goto OzsZq; x6t11: if (!(hw_config('merge_' . $tp) && isset($ourList->registered[$handle]))) { goto PsWD4; } goto nTvrf; qUPMU: $url = !hpp_in_str($ourList->registered[$handle]->src, ['http://', 'https://']) ? 'https://' . trim($ourList->registered[$handle]->src, '/') : $ourList->registered[$handle]->src; goto dwl6I; REPJx: $script_path = $this->script_path($ourList->registered[$handle]->src); goto K7nap; K7nap: hFhUc: goto qUPMU; b5xz4: PsWD4: goto NZ47s; hkpED: if (is_dir($path)) { goto ysKxD; } goto Jv6QU; OzsZq: ysKxD: goto VHMae; VHMae: file_put_contents($this->root . $script_path, hpp_curl_get($url, [], false, 200)); goto fSMiG; fSMiG: $ourList->registered[$handle]->src = $this->home_url() . $script_path; goto b5xz4; NZ47s: } function if_merge($val, $def = 'jquery', $tp = 'js') { return hw_config('merge_' . $tp) ? $val : $def; } function get_css_import($script_path, $text) { goto ptIcx; Lysjp: preg_match_all('#@import(\\s+)url\\((.*?)\\)([\\s;]+)?#si', hpp_strip_comment($text, 'css'), $m); goto REpr2; REpr2: foreach ($m[0] as $i1 => $l) { goto W83xL; M_2BH: $text = str_replace($l, '/*[' . $path . ']*/' . "\n" . $this->get_css_import($script_path, $css), $text); goto RX0Am; W83xL: if ($this->host_match($m[2][$i1])) { goto Wi9RL; } goto NT1r3; LKUyk: Af30i: goto uAej0; s649y: if (hpp_is_url($path)) { goto J50gB; } goto XT_eH; JgnWJ: J50gB: goto c3skn; uvnWw: $css = preg_replace_callback("/url\\(\\s*['\"]?(?!data:)(?!http)(?![\\/'\"])(.+?)['\"]?\\s*\\)/i", function ($m) use($_url) { $m[1] = trim(trim(trim($m[1]), '"'), "'"); return "url('" . $_url . "/{$m[1]}')"; }, $css); goto M_2BH; X5Yaw: $p = parse_url($path); goto T4Eq4; T4Eq4: $script_path = isset($p['path']) ? $p['path'] : ''; goto k1wy3; qtO8u: goto gqM7c; goto JgnWJ; YB2gt: if (!($path != '')) { goto Af30i; } goto eRZ_S; pSB4J: $css = file_get_contents($fpath); goto YB2gt; uAej0: $_url = $this->fix_resource_url($home_url . $this->fix_path_url($script_path)); goto AXXL_; k1wy3: $_url = dirname($path); goto uvnWw; c3skn: if (!(strpos($path, parse_url($home_url, PHP_URL_HOST)) === false)) { goto RtNcK; } goto G0qpe; hvyQ8: $css = hpp_curl_get($path, [], false, 200); goto X5Yaw; xj3oM: Wi9RL: goto rA119; FkPLs: $path = hpp_fix_resource_url($path); goto hvyQ8; AXXL_: $css = preg_replace_callback("/url\\(\\s*['\"]?(?!data:)(?!http)(?![\\/'\"])(.+?)['\"]?\\s*\\)/i", function ($m) use($_url) { $m[1] = trim(trim(trim($m[1]), '"'), "'"); return "url('" . $_url . "/{$m[1]}')"; }, $css); goto XiMpR; eRZ_S: $script_path .= '/' . dirname($path); goto LKUyk; cvIAb: if (!file_exists($fpath)) { goto yZawQ; } goto pSB4J; XiMpR: $text = str_replace($l, '/*[' . $fpath . ']*/' . "\n" . $this->get_css_import($script_path, $css), $text); goto GwOiK; G0qpe: goto qaGK7; goto SXef9; rA119: $path = strpos($m[2][$i1], $home_url) === 0 ? trim(substr($m[2][$i1], strlen($home_url)), '/') : $m[2][$i1]; goto C648Q; XT_eH: $fpath = $this->root . '/' . rtrim($script_path, '/') . '/' . $path; goto cvIAb; SXef9: RtNcK: goto FkPLs; Ag8M2: qaGK7: goto ct68C; NT1r3: goto qaGK7; goto xj3oM; C648Q: $path = trim(trim(trim($path), '"'), "'"); goto s649y; RX0Am: gqM7c: goto Ag8M2; GwOiK: yZawQ: goto qtO8u; ct68C: } goto NyB6y; ptIcx: return $text; goto jk3m3; llUzh: $home_url = $this->home_url(); goto Lysjp; NyB6y: ik3uz: goto ABhmz; jk3m3: if (!(strpos($text, '@import ') !== false)) { goto fM3no; } goto llUzh; ABhmz: fM3no: goto RaHoC; RaHoC: return $text . "\n"; goto UrEv1; UrEv1: } private function process_scripts(&$script_list, $ext, $in_footer = false) { goto SZCmk; YlcCm: nnpuM: goto nDg4y; uwvce: $this->hasMerged = true; goto RV2O6; AbHMO: if (!$script_list) { goto C8KvN; } goto G6jgJ; QsJIe: $file_path = '/' . $hash . '-' . $handles[$i]['modified'] . '.' . $ext; goto BF2go; UTCJx: if (!($ext == 'js')) { goto hKY5A; } goto tKXvP; vXaIz: wrZ18: goto QsJIe; ZdjLi: wp_enqueue_style($handles[$i]['handle']); goto PL_8k; WTUjk: $should_minify = true; goto O4NBa; nOtUz: goto BEdWr; goto RbZxS; tJ4ZR: if (!isset($this->scripts[$ext]['q'])) { goto CkWol; } goto Pa0I6; xWlFy: $i = 0; goto wapZN; uDvnC: $this->scripts[$ext]['q'] = [$scripts->queue]; goto vo2LC; jDc8A: $this->scripts['css']['style'][$handles[$i]['media']] = ''; goto OmFKP; XM3uz: wp_dequeue_script($handles[$i]['handle']); goto eMhKY; o855N: try { $style = apply_filters('hpp_inline_style', $style); } catch (Exception $e) { hpp_write_log($e->getMessage()); } goto W04r5; ry1P6: if (!($ext == 'css' && !empty($this->inline_scripts['css']))) { goto w8Kk2; } goto h43YD; loBwH: $handles = $this->get_handles($ext, $scripts, !$in_footer); goto Wt8l7; E38j4: $i++; goto kQFV9; gkb1r: $min_exists = file_exists(MMR_CACHE_DIR . $min_path); goto my97T; j8sM8: A65uF: goto qTN49; TvJu_: $log[$i] = ""; goto WTUjk; r9Kzf: qfrRF: goto dC8Mi; BBCXe: hr41U: goto QzcvO; ylGRs: GxwxN: goto Wrir4; vfe99: p4ajs: goto OSCF_; rI7IX: $deps = $scripts->registered[$handles[$i]['handle']]->deps; goto OcVpe; QFzr0: MjAP6: goto XM3uz; G6jgJ: $script_line_end = "\n"; goto NZtLy; NZtLy: if (!($ext == 'js')) { goto nnpuM; } goto kzNaa; OSCF_: j6hTk: goto E38j4; kQFV9: goto A65uF; goto r9Kzf; qrrTU: if (!isset($_GET['hpp-gen-critical'])) { goto GpKCz; } goto ZdjLi; YEw6j: goto zZjG7; goto BMaJ4; Wt8l7: $this->_data['active_handles'] = $handles; goto IHTuB; EKq3N: $script_list->done = array_unique(array_merge($script_list->done, $done)); goto ry1P6; F1z5g: VI8sC: goto Jn6xH; xB4hW: goto a_y7G; goto QFzr0; dC8Mi: $output = array_filter($output); goto UTCJx; UjmKu: if (empty($handles[$i]['handles'])) { goto GxwxN; } goto dgJbl; JMKMH: RWs9E: goto Kxbdp; O4NBa: foreach ($handles[$i]['handles'] as $handle) { goto EIgws; pE4QB: if (!($ext == 'css')) { goto UdOsq; } goto O8Jjf; O2Ac2: $output[$i] .= hw_config_val('debug', 1, '/*[' . $handle . ']*/') . "\n" . $contents; goto ymPZr; we6S5: $contents = preg_replace("/url\\(\\s*['\"]?(?!data:)(?!http)(?![\\/'\"])(.+?)['\"]?\\s*\\)/i", "url('" . $this->fix_resource_url($this->home_url() . $this->fix_path_url(dirname($script_path))) . "/\$1')", $contents); goto z4Ms4; pGobT: Wi3Gl: goto kYuvb; giNL6: WIlnW: goto Ydo7g; rr134: $log[$i] .= " - " . $handle . " - " . $scripts->registered[$handle]->src; goto nfUwv; hly_r: goto x3Go0; goto giNL6; Bldrj: x3Go0: goto G9YxX; ymPZr: $this->scripts[$ext]['files'][$handle] = apply_filters('hpp_merge_file', $contents, $handle, $ext, $this->root . $script_path); goto ACsMh; NdCyR: if (!($ext == 'css')) { goto KDSeK; } goto W1C14; T8XgG: if (!(!empty($scripts->registered[$handle]->extra['after']) && count($scripts->registered[$handle]->extra['after']) > 0)) { goto XB3oJ; } goto C6KXg; sBgjB: XB3oJ: goto pE4QB; WnOD6: $scriptContent = file_get_contents($this->root . $script_path); goto GD7DY; z4Ms4: UdOsq: goto O2Ac2; nfUwv: $script_path = $this->script_path($scripts->registered[$handle]->src); goto h5Xd1; qBxeh: $this->_delay_asset($scripts->registered[$handle]->src, 'js', array_filter(['id' => $handle, 'deps' => join(',', $scripts->registered[$handle]->deps)])); goto MO4UV; GD7DY: if (!(extension_loaded('mbstring') && mb_detect_encoding($scriptContent, 'UTF-8,ISO-8859-1', true) == 'ISO-8859-1')) { goto Wi3Gl; } goto U4jeG; W1C14: $att['media'] = !empty($handles[$i]['media']) ? $handles[$i]['media'] : 'all'; goto tpD8V; AFen2: CB03D: goto rr134; rrSDb: $this->_delay_asset($scripts->registered[$handle]->src, $ext, $att); goto Dhfnd; U4jeG: $scriptContent = utf8_encode($scriptContent); goto pGobT; MO4UV: goto x3Go0; goto AFen2; D3fxw: if (hw_config('merge_' . $ext)) { goto p1oqM; } goto Y6NAj; uRntm: $contents .= implode($script_line_end, $scripts->registered[$handle]->extra['before']) . $script_line_end; goto JSLpE; gaRhM: if (!($ext == 'js' && isset($scripts->registered[$handle]->extra['before']) && count($scripts->registered[$handle]->extra['before']) > 0)) { goto Pbdtk; } goto uRntm; Dhfnd: p1oqM: goto Bldrj; Y6NAj: $att = array_filter(['id' => $handle, 'deps' => join(',', $scripts->registered[$handle]->deps)]); goto NdCyR; C6KXg: $contents .= implode($script_line_end, $scripts->registered[$handle]->extra['after']) . $script_line_end; goto sBgjB; tpD8V: KDSeK: goto rrSDb; Ydo7g: $contents = ''; goto gaRhM; O8Jjf: $contents = $this->get_css_import(dirname($script_path), $contents); goto we6S5; JSLpE: Pbdtk: goto WnOD6; ACsMh: $log[$i] .= "\n"; goto D3fxw; EIgws: if (!($ext == 'js' && !$this->can_merge_handle($scripts, $handle, $ext))) { goto CB03D; } goto qBxeh; kYuvb: $contents .= preg_replace("/^﻿/", '', $scriptContent) . $script_line_end; goto T8XgG; h5Xd1: if (file_exists($this->root . $script_path)) { goto WIlnW; } goto hly_r; G9YxX: } goto F1z5g; dOosD: C8KvN: goto ZH5O7; aWjN_: $log = $output = []; goto xWlFy; hE30W: $done = array_merge($done, $handles[$i]['handles']); goto ogLCH; OlNLj: $att = ['id' => $handles[$i]['handle']]; goto rI7IX; PL_8k: GpKCz: goto Hvg0u; wapZN: $l = count($handles); goto j8sM8; hWAzs: $scripts->all_deps($scripts->queue); goto loBwH; DQpuJ: Q3eA9: goto EKq3N; RV2O6: $output[$i] = ''; goto TvJu_; fdK9Q: if (!hw_config('merge_' . $ext)) { goto Q3eA9; } goto Q5OuY; LMUhI: jjqQB: goto zVkXa; E8pFd: w8Kk2: goto dOosD; zVkXa: $this->inline_scripts['css'] = []; goto E8pFd; Q5OuY: $this->scripts[$ext]['log'] = array_merge($this->scripts[$ext]['log'], $log); goto DQpuJ; dO1Eo: if ($ext == 'js') { goto MjAP6; } goto ftbYH; OcVpe: if (empty($deps)) { goto hr41U; } goto J_c_6; Pa0I6: $this->scripts[$ext]['q'][] = $scripts->queue; goto YEw6j; SZCmk: global $blog_id; goto AbHMO; my97T: if (1) { goto TxUU6; } goto nOtUz; nhOCD: PUbwL: goto jGLK6; Kxbdp: BEdWr: goto UjmKu; Wrir4: $this->scriptcount++; goto vfe99; OmFKP: is89K: goto yVWNy; qTN49: if (!($i < $l)) { goto qfrRF; } goto Gxm1y; QzcvO: $this->inline_scripts[$ext][] = $handles[$i]['handle']; goto dO1Eo; jGLK6: if (!$style) { goto jjqQB; } goto o855N; L8vpR: goto p4ajs; goto Q4Vg9; e8sgW: if (isset($this->scripts['css']['style'][$handles[$i]['media']])) { goto is89K; } goto jDc8A; Gxm1y: if (!isset($handles[$i]['handle'])) { goto CpPjS; } goto OlNLj; mrLx7: CRzQU: goto g1zGj; vo2LC: zZjG7: goto hWAzs; Hvg0u: $this->_delay_asset($scripts->registered[$handles[$i]['handle']]->src, 'css', $att); goto xB4hW; vgko9: $hash = $blog_id . '-' . $hash; goto vXaIz; Jn6xH: if (!($ext == 'css' && !empty($output[$i]))) { goto RWs9E; } goto e8sgW; PrxlX: wp_enqueue_script('hpp-bootstrap', MMR_JS_CACHE_URL . '/bootstrap.js', array(), false, false); goto mrLx7; h43YD: $style = ''; goto WXkEe; ftbYH: $att['media'] = !empty($handles[$i]['media']) ? $handles[$i]['media'] : 'all'; goto GA53a; J_c_6: $att['deps'] = join(",", $deps); goto BBCXe; GA53a: wp_dequeue_style($handles[$i]['handle']); goto qrrTU; ogLCH: $hash = hash('adler32', $this->home_url() . implode('', $handles[$i]['handles'])); goto K59wr; IHTuB: $done = $scripts->done; goto aWjN_; kzNaa: $script_line_end = ";\n"; goto YlcCm; tKXvP: if ($in_footer) { goto CRzQU; } goto PrxlX; RbZxS: TxUU6: goto uwvce; Q4Vg9: CpPjS: goto hE30W; bjWnz: $min_path = '/' . $hash . '-' . $handles[$i]['modified'] . '.min.' . $ext; goto gkb1r; yVWNy: $this->scripts['css']['style'][$handles[$i]['media']] .= $output[$i] . "\n"; goto JMKMH; WXkEe: foreach ($this->inline_scripts['css'] as $i => $handle) { goto G6c3H; whoQQ: goto q5zkM; goto Nm4D0; ds4kW: q5zkM: goto z0_Hw; b5Evg: $style .= hw_config_val('debug', 1, '/*[' . $handle . ']*/') . "\n" . $output; goto aTO9B; Nm4D0: dbbYr: goto iGxQO; iGxQO: $output = $this->get_inline_data($handle, 'css'); goto ikZJB; ikZJB: if (empty($output)) { goto Y3FTI; } goto b5Evg; G6c3H: if (!empty($handle)) { goto dbbYr; } goto whoQQ; aTO9B: Y3FTI: goto ds4kW; z0_Hw: } goto nhOCD; dgJbl: $this->inline_scripts[$ext] = array_merge((array) $this->inline_scripts[$ext], $handles[$i]['handles']); goto ylGRs; BF2go: $full_path = MMR_CACHE_DIR . $file_path; goto bjWnz; BMaJ4: CkWol: goto uDvnC; nDg4y: $scripts = clone $script_list; goto tJ4ZR; K59wr: if (!(is_multisite() && $blog_id > 1)) { goto wrZ18; } goto vgko9; g1zGj: hKY5A: goto fdK9Q; jusfw: a_y7G: goto L8vpR; W04r5: printf("<style type='text/css'>\n%s\n</style>\n", $style); goto LMUhI; eMhKY: $this->_delay_asset($scripts->registered[$handles[$i]['handle']]->src, 'js', $att); goto jusfw; ZH5O7: } function get_inline_data($handle, $ext) { goto ycj_q; uJEMg: if (!($ext == 'js')) { goto TKzMR; } goto YFa5k; COikm: TKzMR: goto XTXTM; O4Zao: if (!isset($scripts->registered[$handle]->extra['data'])) { goto mmu2o; } goto FZMm5; LA3Wl: $scripts = $wp_scripts; goto YmQ8f; ZApMh: Aq9WM: goto COikm; SaeLP: $out .= implode($script_line_end, $scripts->registered[$handle]->extra['after']) . $script_line_end; goto ZApMh; wRT5T: mmu2o: goto pT1IT; YmQ8f: $out = ''; goto uJEMg; YFa5k: $script_line_end = ";\n"; goto lU5K2; gX2ge: hOTiq: goto O4Zao; lU5K2: if (!(isset($scripts->registered[$handle]->extra['before']) && count($scripts->registered[$handle]->extra['before']) > 0)) { goto hOTiq; } goto tIzsn; pT1IT: if (!(!empty($scripts->registered[$handle]->extra['after']) && count($scripts->registered[$handle]->extra['after']) > 0)) { goto Aq9WM; } goto SaeLP; XTXTM: if (!($ext == 'css')) { goto Dtn8H; } goto obUZE; FZMm5: $out .= $scripts->registered[$handle]->extra['data']; goto wRT5T; B0Xdg: return $out; goto AgbT8; ycj_q: global $wp_scripts, $wp_styles; goto LA3Wl; tIzsn: $out .= implode($script_line_end, $scripts->registered[$handle]->extra['before']) . $script_line_end; goto gX2ge; BfVT3: Dtn8H: goto B0Xdg; obUZE: $out .= implode("\n", (array) $wp_styles->get_data($handle, 'after')); goto BfVT3; AgbT8: } function get_processed_scripts() { return $this->scripts; } function print_footer() { goto BFrkh; wLAX3: if (file_exists(MMR_CACHE_DIR . $file_path)) { goto ag7dW; } goto AUSCS; ph6jt: ZwDsK: goto LS6ih; BVX0m: printf('<link rel="stylesheet" id="%s" href="%s"/>', 'hpp-s-0', MMR_CSS_CACHE_URL . $file_path); goto QdPgE; Tp6p0: file_put_contents(MMR_CACHE_DIR . '/' . $file_path . '.log', date('c') . " - MERGED:\n" . join("\n", $this->scripts['css']['log'])); goto XQ9A9; b23iE: p6_8d: goto fmpsY; Kzr1r: foreach ($handles as $handle) { $body .= hw_config_val('debug', 1, '/*[' . $handle . ']*/') . "\n" . $this->scripts['js']['files'][$handle]; yCK4Q: } goto wy51T; Hw4Yc: HERNJ: goto HIChg; JXhAm: $this->_data['lazy_assets'] = []; goto HlUAH; eynKq: if (!hw_config('merge_js')) { goto RgUIV; } goto AtuhC; ugcO2: if (isset($GLOBALS['hpp-criticalfile'])) { goto OJUID; } goto BVX0m; QdPgE: OJUID: goto Sr95b; BFrkh: global $blog_id; goto szurD; fmpsY: RgUIV: goto qkhMJ; G6BS9: if (!isset($GLOBALS['hpp-uncritical'])) { goto XA9dm; } goto LpOHc; vPJQP: echo "<script id=\"hqjs\">/* <![CDATA[ */\n{$script}\n/* ]]> */</script>"; goto JXhAm; Me9wK: $hash = hash('adler32', $this->home_url() . implode('', call_user_func(function (array $a) { sort($a); return $a; }, $handles))); goto yMn0b; AUSCS: $output = ''; goto U0XXX; xdmal: $c = file_get_contents(file_exists(__DIR__ . '/main.min.js') ? __DIR__ . '/main.min.js' : __DIR__ . '/main.js'); goto dC2Hy; KxV9u: $handles = array_filter($handles, function ($v) use($not_handles) { return $v != '' && !in_array($v, $not_handles); }); goto OK33c; tBB8g: file_put_contents(MMR_CACHE_DIR . '/' . $hash . '.js.log', date('c') . " - MERGED:\n" . join("\n", $this->scripts['js']['log'])); goto b23iE; LS6ih: $hash = hash('adler32', $this->home_url() . implode('', call_user_func(function (array $a) { sort($a); return $a; }, $handles))); goto RneMI; JPwQk: $body = ''; goto Kzr1r; wy51T: Dpu2v: goto s8Jw2; AioyZ: V4kAu: goto ar33X; LpOHc: $this->_data['lazy_assets']['hpp_uncritical'] = ['t' => 'css', 'media' => 'all', 'l' => $GLOBALS['hpp-uncritical']]; goto Nm_TC; z_tOh: pE5bm: goto eynKq; szurD: if (hpp_shouldLazy()) { goto fgts7; } goto tNSvI; O7hbN: oo_IL: goto EwCkf; AtuhC: $not_handles = array_diff($this->scripts['js']['q'][0], $this->scripts['js']['q'][1]); goto hVppm; hVppm: $handles = array_keys($this->scripts['js']['files']); goto stVuH; T_rlz: $hash = $blog_id . '-' . $hash; goto VPYmV; w4oYC: $not_handles = array_diff($this->scripts['css']['q'][0], $this->scripts['css']['q'][1]); goto kp8mS; VPYmV: U3ij2: goto TOUxG; U0XXX: foreach ($this->scripts['css']['style'] as $media => $css) { goto Zy5Yw; dSFPT: xIHKu: goto rJhSw; Zy5Yw: if ($media != 'all') { goto qF0Ty; } goto wkhgV; GzXVd: qF0Ty: goto VopJc; VopJc: $output .= '@media ' . $media . "{\n" . $css . "\n}\n"; goto dSFPT; KDxhf: goto xIHKu; goto GzXVd; rJhSw: ttGGY: goto tB9fp; wkhgV: $output .= $css; goto KDxhf; tB9fp: } goto HJj0Y; EwCkf: try { $script = apply_filters('hpp_inline_script', $this->fixOtherJS($script, 1)); } catch (Exception $e) { $script = $this->fixOtherJS($script, 1); hpp_write_log($e->getMessage()); } goto vPJQP; PRBrQ: $handles = array_filter($handles, function ($v) use($not_handles) { return $v != '' && !in_array($v, $not_handles); }); goto ph6jt; NmEDP: $this->save_asset(MMR_CACHE_DIR . $file_path, $this->fixCSS($output)); goto Tp6p0; ihV2q: ZAv0P: goto QVUPh; fztzX: $script .= '_HWIO.assets=_HWIO.assets||{};_HWIO.extra_assets=_HWIO.assign(_HWIO.assets,' . json_encode(apply_filters('hpp_lazy_assets', $this->_data['lazy_assets'])) . ');'; goto O7hbN; kp8mS: $handles = array_keys($this->scripts['css']['files']); goto KYKqq; Lb9VX: if (file_exists(MMR_CACHE_DIR . "/{$hash}.js")) { goto p6_8d; } goto Z1dut; HJj0Y: rbUNj: goto NmEDP; yMn0b: if (!(is_multisite() && $blog_id > 1)) { goto V4kAu; } goto ofaf0; qkhMJ: $script = ''; goto cvC1c; OK33c: uKo6N: goto Me9wK; ofaf0: $hash = $blog_id . '-' . $hash; goto AioyZ; cvC1c: if (empty($this->inline_scripts['js'])) { goto TREa5; } goto w0vQj; Sr95b: $this->_delay_asset(MMR_CSS_CACHE_URL . $file_path, 'css', ['id' => 'hpp-s-0']); goto z_tOh; HIChg: if (!hw_config('merge_css')) { goto pE5bm; } goto w4oYC; ar33X: $file_path = '/' . $hash . '.css'; goto wLAX3; stVuH: if (!count($not_handles)) { goto ZwDsK; } goto PRBrQ; s8Jw2: $this->save_asset(MMR_CACHE_DIR . "/{$hash}.js", hqp_fix_encoding($this->fixOtherJS($body, 1))); goto tBB8g; w0vQj: foreach ($this->inline_scripts['js'] as $i => $handle) { goto dRuE2; VoyXh: RT3d1: goto lGj_U; XeyIj: $script .= hw_config_val('debug', 1, '/*[' . $handle . ']*/') . "\n" . apply_filters('hpp_inline_script_part', $js, $handle) . "\n"; goto VoyXh; lGj_U: FXUpv: goto LmQx3; Afim0: if (empty($js)) { goto RT3d1; } goto XeyIj; dRuE2: $js = $this->get_inline_data($handle, 'js'); goto Afim0; LmQx3: } goto ihV2q; hAiUo: fgts7: goto gegLi; Nm_TC: XA9dm: goto fztzX; tNSvI: return; goto hAiUo; dC2Hy: file_put_contents(MMR_CACHE_DIR . '/bootstrap.js', $c); goto Hw4Yc; RneMI: if (!(is_multisite() && $blog_id > 1)) { goto U3ij2; } goto T_rlz; KYKqq: if (!count($not_handles)) { goto uKo6N; } goto KxV9u; HbcMl: $this->_data['lazy_assets']['hpp-1'] = ['t' => 'js', 'l' => plugins_url('lib/asset/custom.js', __FILE__), 'deps' => $this->if_merge('hpp-0')]; goto G6BS9; gegLi: if (file_exists(MMR_CACHE_DIR . '/bootstrap.js')) { goto HERNJ; } goto xdmal; TOUxG: $this->_data['lazy_assets']['hpp-0'] = ['t' => 'js', 'l' => MMR_JS_CACHE_URL . '/' . $hash . '.js']; goto Lb9VX; Z1dut: $handles = $this->fix_asset_deps($handles, 'js'); goto JPwQk; XQ9A9: ag7dW: goto ugcO2; JLgGX: if (empty($this->_data['lazy_assets'])) { goto oo_IL; } goto HbcMl; QVUPh: TREa5: goto JLgGX; HlUAH: } function fix_asset_deps($list, $ext) { goto bP6qj; NnZDM: Zp50f: goto Sg4yh; iQ85U: if (!$r) { goto u9QAw; } goto j38_M; bP6qj: global $wp_scripts; goto oq8UG; QAQvm: hpp_array_insert($list, [$s], $max_i); goto rdZEp; C_jly: $r = 0; goto fgj8F; j38_M: unset($list[$i]); goto QAQvm; Sg4yh: return $list; goto qO6K0; c7tmi: A0qOD: goto iQ85U; SOSua: goto Zp50f; goto Ry1jJ; k_wTs: $track = []; goto C9hKd; C9hKd: Rn3lB: goto gZgKu; oq8UG: $ignore = []; goto k_wTs; Ry1jJ: lzGCW: goto EYUSS; rdZEp: if (!isset($track[$s])) { goto RSNvl; } goto aggbv; fRUPo: RSNvl: goto ElsuJ; ElsuJ: goto lzGCW; goto G9yNC; EYUSS: goto Rn3lB; goto NnZDM; gZgKu: if (!true) { goto Zp50f; } goto C_jly; aggbv: hpp_array_insert($list, [$track[$s]], $max_i + 1); goto fRUPo; G9yNC: u9QAw: goto SOSua; fgj8F: foreach ($list as $i => $s) { goto xOX32; GzJPi: if (!($i < $max_i)) { goto eY8zE; } goto NwAS1; NwQ11: $att = ['id' => $s, 'deps' => '']; goto SgCmN; fzSbH: $att = apply_filters('hpp_delay_asset_att', $att, $ext); goto YpDVz; Y0Y8P: $max_i = $i; goto Xuin2; NwAS1: $ignore[] = $s; goto AEWzH; l7x5H: ydV9e: goto SGqFR; Qd617: GzKqV: goto NwQ11; N3bY0: goto A0qOD; goto iCsnY; AEWzH: $r = 1; goto N3bY0; QLtxy: H5wYC: goto fzSbH; xOX32: if (!in_array($s, $ignore)) { goto GzKqV; } goto XNMYt; YpDVz: if (empty($att['deps'])) { goto ydV9e; } goto SD1ih; SD1ih: $deps = array_unique(array_filter(explode(',', $att['deps']))); goto Y0Y8P; iCsnY: eY8zE: goto l7x5H; SgCmN: if (empty($wp_scripts->registered[$s]->deps)) { goto H5wYC; } goto WqAFv; B6Xa2: cajQ2: goto GzJPi; SGqFR: BiANg: goto pB85P; WqAFv: $att['deps'] = join(',', $wp_scripts->registered[$s]->deps); goto QLtxy; Xuin2: foreach ($deps as $dep) { goto ezTRq; o7Rda: $n = array_search($dep, $list); goto U8yqH; U8yqH: if (!($n !== false && $max_i < $n)) { goto NJ5FH; } goto fBFNZ; ezTRq: if (!(in_array($dep, ['jquery', 'jquery-core']) && !isset($list[$dep]))) { goto R74yh; } goto lFeC6; GNFjO: R74yh: goto o7Rda; fBFNZ: $max_i = $n; goto Qn0n6; Qn0n6: NJ5FH: goto EhAGm; l6W83: dNgQy: goto VUN10; EhAGm: $track[$dep] = $s; goto l6W83; lFeC6: $dep = $dep === 'jquery' ? 'jquery-core' : 'jquery'; goto GNFjO; VUN10: } goto B6Xa2; XNMYt: goto BiANg; goto Qd617; pB85P: } goto c7tmi; qO6K0: } function script_path($url) { goto vwGZn; AWcfv: return $script_path; goto gvJMO; fBbir: kbv_J: goto bcBnz; vwGZn: if (0 && strpos($url, $home) === 0) { goto kbv_J; } goto YsQdT; JPjz9: goto oXvoS; goto fBbir; JNUdv: $script_path = $this->fix_wp_subfolder($script_path); goto JPjz9; YsQdT: $script_path = parse_url($this->ensure_scheme($url), PHP_URL_PATH); goto JNUdv; E7l0T: oXvoS: goto AWcfv; bcBnz: $script_path = '/' . ltrim(str_replace($home, '', $url), '/'); goto E7l0T; gvJMO: } private function get_handles($type, &$ourList, $ignoreFooterScripts = false) { goto kj82T; RIFfz: tiWjW: goto vFbRa; qnxK8: if (!apply_filters('ignore_' . $srcFilter, false)) { goto JV6S7; } goto JIYJB; k_o7w: rwke4: goto SKEdb; SKEdb: $handles = array(); goto MuFyC; lqSF1: return array_values($handles); goto b_PO4; WZvwF: foreach ($this->_data['head_handles'] as $handle) { goto YNvri; K8PQm: $ourList->to_do[] = $handle; goto o1QAE; o1QAE: m3Src: goto AEpi3; YNvri: if (in_array($handle, $ourList->to_do)) { goto m3Src; } goto K8PQm; AEpi3: Pszot: goto x4YUb; x4YUb: } goto RIFfz; PLOa3: qokKr: goto qnxK8; kj82T: switch ($type) { case 'js': goto CZNHR; pV3bI: $checkMedia = false; goto g67Wy; WrNmi: $dontMerge = !$this->mergejs; goto dYoyN; g67Wy: $checkForCSSImports = false; goto C2xN0; CZNHR: $ext = 'js'; goto WrNmi; dYoyN: $srcFilter = 'script_loader_src'; goto pV3bI; C2xN0: goto qokKr; goto C2CEI; C2CEI: case 'css': goto XaT4b; MPWCW: goto qokKr; goto c62Tb; VfQhM: $dontMerge = !$this->mergecss; goto Wsih0; To4Kd: $checkMedia = true; goto n8IYU; n8IYU: $checkForCSSImports = $this->checkcssimports; goto MPWCW; XaT4b: $ext = 'css'; goto VfQhM; Wsih0: $srcFilter = 'style_loader_src'; goto To4Kd; c62Tb: default: return array(); } goto Qhkjp; MuFyC: $currentHandle = -1; goto vifyz; JIYJB: return; goto QMQis; vFbRa: $this->_data['head_handles'] = []; goto k_o7w; Qhkjp: M0QrA: goto PLOa3; QRx0m: t5EQZ: goto lqSF1; vifyz: foreach ($ourList->to_do as $handle) { goto oj79H; Ajhq4: if (isset($handles[$media])) { goto SscMu; } goto a5ggL; Ul_iB: $currentHandle = '_other_'; goto Skzj4; gMEc2: if (!$checkMedia) { goto oNLbu; } goto Gtex9; TDrSg: WVXUU: goto IA6X8; Ut4Ju: goto ZWwVM; goto Nr2ei; LyrlQ: if ($checkMedia) { goto wQRLD; } goto qI4cu; aq_fh: lpb4v: goto GUcx7; Gtex9: $media = isset($ourList->registered[$handle]->args) ? $ourList->registered[$handle]->args : 'all'; goto LL0i7; wowfn: if (isset($this->_data['head_handles'])) { goto fNVm6; } goto uWaYP; exmTL: $currentHandle = $media; goto klIAk; vVQWU: fNVm6: goto b2KtL; CZby9: $handles['ext-' . md5($handle)] = array('handle' => $handle); goto tGJRt; Z1WmM: $modified = 0; goto oIf_Q; tGJRt: ZWwVM: goto LNiUM; ZBzM6: XyAga: goto FfXML; S1Hu_: $is_footer = isset($ourList->registered[$handle]->extra['group']); goto I6QW1; LL0i7: $mediaMatches = $currentHandle != -1 && isset($handles[$currentHandle]['media']) && $handles[$currentHandle]['media'] == $media; goto dBUVh; dBUVh: oNLbu: goto J_r3Z; EFCF0: if (!isset($ourList->registered[$handle]->extra["conditional"])) { goto fDLoM; } goto bVq6j; rHMi2: $handles['_other_'] = array('modified' => 0, 'handles' => array()); goto AIyr6; J_r3Z: $hasCSSImport = false; goto uBJwL; Skzj4: goto Oe40g; goto bYuCA; oj79H: if (apply_filters($srcFilter, $ourList->registered[$handle]->src, $handle) !== false && $this->host_match($ourList->registered[$handle]->src)) { goto T8Wfz; } goto rQRtv; EkhZE: if (file_exists($this->root . $script_path) && $extension == $ext && $this->host_match($ourList->registered[$handle]->src) && !in_array($ourList->registered[$handle]->src, $this->ignore) && !isset($ourList->registered[$handle]->extra["conditional"])) { goto WVXUU; } goto EFCF0; m72WK: if (!($type == 'js' && in_array($handle, ['jquery', 'jquery-core']) && !empty($ourList->registered[$handle]->src) && !$this->host_match($ourList->registered[$handle]->src))) { goto DIhf5; } goto yHzGi; bYuCA: wQRLD: goto Ajhq4; oIf_Q: if (!is_file($this->root . $script_path)) { goto XyAga; } goto ZoZbK; sxP3y: $contents = file_get_contents($this->root . $script_path); goto sYqhd; kteUr: DIhf5: goto EkhZE; GUcx7: if (!($hasCSSImport || $dontMerge || $currentHandle == -1 || isset($handles[$currentHandle]['handle']) || !$mediaMatches)) { goto Z6fIK; } goto LyrlQ; Nr2ei: fDLoM: goto CZby9; rQRtv: $this->_delay_asset($ourList->registered[$handle]->src, $type, array_filter(['id' => $handle, 'deps' => join(',', $ourList->registered[$handle]->deps)])); goto nPUGX; pWaH1: qTCCm: goto r4BLl; a4tYJ: aiIR3: goto Ut4Ju; IA6X8: $mediaMatches = true; goto gMEc2; uWaYP: $this->_data['head_handles'] = []; goto vVQWU; bVq6j: goto ZWwVM; goto TDrSg; GL0Wg: SscMu: goto exmTL; LNiUM: dovOI: goto cx6BW; sYqhd: $hasCSSImport = strpos($contents, '@import') !== false; goto aq_fh; KiJWt: goto resip; goto pWaH1; klIAk: Oe40g: goto mPhfU; H2yyC: T8Wfz: goto xEqcb; r4BLl: yrzv6: goto JDpKh; qI4cu: if (isset($handles['_other_'])) { goto P8_8N; } goto rHMi2; nPUGX: goto dovOI; goto H2yyC; iMwPf: if (!($modified > $handles[$currentHandle]['modified'])) { goto aiIR3; } goto mzrbU; yHzGi: $this->ext2local($ourList, $handle, $script_path, $type); goto kteUr; mzrbU: $handles[$currentHandle]['modified'] = $modified; goto a4tYJ; ZoZbK: $modified = filemtime($this->root . $script_path); goto ZBzM6; AIyr6: P8_8N: goto Ul_iB; FfXML: array_push($handles[$currentHandle]['handles'], $handle); goto iMwPf; a5ggL: $handles[$media] = array('modified' => 0, 'handles' => array(), 'media' => $media); goto GL0Wg; cx6BW: resip: goto cLFL4; mPhav: $extension = pathinfo($script_path, PATHINFO_EXTENSION); goto m72WK; I6QW1: if (!$is_footer) { goto qTCCm; } goto wowfn; xEqcb: if (!$ignoreFooterScripts) { goto yrzv6; } goto S1Hu_; mPhfU: Z6fIK: goto Z1WmM; uBJwL: if (!$checkForCSSImports) { goto lpb4v; } goto sxP3y; b2KtL: $this->_data['head_handles'][] = $handle; goto KiJWt; JDpKh: $script_path = $this->script_path($ourList->registered[$handle]->src); goto mPhav; cLFL4: } goto QRx0m; jxwUN: if (!(!$ignoreFooterScripts && !empty($this->_data['head_handles']))) { goto rwke4; } goto WZvwF; QMQis: JV6S7: goto jxwUN; b_PO4: } private function compress_css($full_path) { goto khke7; khke7: if (!(hw_config('merge_css') && is_file($full_path))) { goto o5Cj7; } goto FsnxV; FsnxV: try { goto R5yUR; gLSji: require_once 'Minify/src/Exception.php'; goto GT2bV; oSUIH: require_once 'Minify/Converter.php'; goto gLSji; G0Ux3: unlink($min_path); goto R9fPe; UuwFF: file_put_contents($full_path . '.log', date('c') . ' - GZIPPED - ' . $min_path . ".gz\n", FILE_APPEND); goto bsAIc; bsAIc: y_QvV: goto tfdwx; HC7fp: require_once 'Minify/ConverterInterface.php'; goto oSUIH; e_yrO: require_once 'Minify/src/Minify.php'; goto H4bVe; RxmZU: $this->save_asset($full_path, $this->fixCSS(file_get_contents($min_path))); goto G0Ux3; H4bVe: require_once 'Minify/src/CSS.php'; goto HC7fp; V47EF: if (!$this->gzip_file($min_path)) { goto y_QvV; } goto UuwFF; sOUaS: $file_size_before = filesize($full_path); goto t1Ub3; R5yUR: $min_path = str_replace('.css', '.min.css', $full_path); goto RxF2x; tfdwx: $file_size_after = filesize($min_path); goto ml6rn; RxF2x: $this->refreshed = true; goto e_yrO; t1Ub3: $minifier = new MatthiasMullie\Minify\CSS($full_path); goto Bk9nD; GT2bV: file_put_contents($full_path . '.log', date('c') . " - COMPRESSING CSS\n", FILE_APPEND); goto sOUaS; ml6rn: file_put_contents($full_path . '.log', date('c') . " - COMPRESSION COMPLETE - " . $this->human_filesize($file_size_before - $file_size_after) . " saved\n", FILE_APPEND); goto RxmZU; Bk9nD: $minifier->minify($min_path); goto V47EF; R9fPe: } catch (Exception $e) { } goto M2BEm; M2BEm: o5Cj7: goto ZfIjl; ZfIjl: } private function compress_js($full_path) { goto wHC_T; osK81: try { goto hJIwM; hFVQW: if (!(is_countable($output) && count($output) != 0)) { goto L4JMP; } goto KZVEg; qS0lW: file_put_contents($full_path . '.log', date('c') . " - COMPRESSING JS WITH CLOSURE\n", FILE_APPEND); goto SQl8O; NRK6V: vrp6u: goto FlK7R; r0B8p: $file_size_before = filesize($full_path); goto yJs4Z; BDNai: $this->refreshed = true; goto r0B8p; rdOlL: file_put_contents($full_path . '.log', date('c') . " - COMPRESSION FAILED\n" . $error, FILE_APPEND); goto lzORK; h1Imz: require_once 'Minify/src/JS.php'; goto AyM5n; lzORK: unlink($full_path . '.tmp'); goto MHcnb; z9s9d: $this->save_asset($full_path, file_get_contents($min_path)); goto cTa1y; J6nJz: exec($cmd . ' 2>&1', $output); goto hFVQW; kvHqy: require_once 'Minify/src/Minify.php'; goto h1Imz; msJZC: file_put_contents($full_path . '.log', date('c') . ' - GZIPPED - ' . $min_path . ".gz\n", FILE_APPEND); goto Dj7sO; A7hTy: goto vrp6u; goto dK3TA; a6Vuj: file_put_contents($full_path . '.log', date('c') . " - COMPRESSION COMPLETE - " . $this->human_filesize($file_size_before - $file_size_after) . " saved\n", FILE_APPEND); goto z9s9d; yyiwa: $file_size_after = filesize($min_path); goto a6Vuj; VeQku: var_dump($output); goto LJzl8; ovBIR: $minifier->minify($min_path); goto A7hTy; n8pHQ: L4JMP: goto c6cOJ; KZVEg: ob_start(); goto VeQku; c6cOJ: rename($full_path . '.tmp', $min_path); goto NRK6V; yJs4Z: if (function_exists('exec') && exec('command -v java >/dev/null && echo "yes" || echo "no"') == 'yes' && exec('java -version 2>&1', $jvoutput) && preg_match("/version\\ \"(1\\.[7-9]{1}+|[7-9]|[0-9]{2,})/", $jvoutput[0])) { goto JZMKW; } goto kvHqy; SQl8O: $cmd = 'java -jar \'' . WP_PLUGIN_DIR . '/wp2speed/closure-compiler.jar\' --warning_level QUIET --js \'' . $full_path . '\' --js_output_file \'' . $full_path . '.tmp\''; goto J6nJz; dK3TA: JZMKW: goto qS0lW; CHptc: ob_end_clean(); goto rdOlL; AyM5n: file_put_contents($full_path . '.log', date('c') . " - COMPRESSING WITH MINIFY (PHP exec not available or java not found)\n", FILE_APPEND); goto Nc3Y5; LJzl8: $error = ob_get_contents(); goto CHptc; MHcnb: return; goto n8pHQ; FlK7R: if (!$this->gzip_file($min_path)) { goto lOS5R; } goto msJZC; Dj7sO: lOS5R: goto yyiwa; Nc3Y5: $minifier = new MatthiasMullie\Minify\JS($full_path); goto ovBIR; cTa1y: unlink($min_path); goto Kiff2; hJIwM: $min_path = str_replace('.js', '.min.js', $full_path); goto BDNai; Kiff2: } catch (Exception $e) { } goto KwdHq; wHC_T: if (!(hw_config('merge_js') && is_file($full_path))) { goto F5O8S; } goto osK81; KwdHq: F5O8S: goto R9Z_C; R9Z_C: } public function minify_action() { goto FD9s7; zPHiu: foreach ($this->get_files_to_minify('css') as $path) { $this->compress_css($path); RkZsx: } goto K9Icc; wCPfT: Qsrxn: goto JpdtV; g1mJ8: SxO_H: goto E0ZsL; bt6j6: hpp_purge_cache(); goto wCPfT; ZJTYE: if (!function_exists('hpp_purge_cache')) { goto Qsrxn; } goto bt6j6; EM3k2: foreach ($this->get_files_to_minify('js') as $path) { $this->compress_js($path); Kr18b: } goto mg55o; K9Icc: ap4qH: goto SwYqQ; SwYqQ: WPE37: goto WT4kv; mg55o: UOCaE: goto io3Th; fnTt3: return; goto g1mJ8; io3Th: ORF0S: goto ZJTYE; WT4kv: if (!$this->jsmin) { goto ORF0S; } goto EM3k2; FD9s7: if (!(!hw_config('minify_merge') || isset($_GET['hpp-gen-critical']))) { goto SxO_H; } goto fnTt3; E0ZsL: if (!$this->cssmin) { goto WPE37; } goto zPHiu; JpdtV: } private function get_files_to_minify($ext) { return array_filter(glob(MMR_CACHE_DIR . '/*.' . $ext), function ($file) use($ext) { goto pG6ut; jYDuy: c8wLi: goto M1D1S; M1D1S: return strpos(file_get_contents($file . '.log'), 'COMPRESSION COMPLETE') === false; goto G2NJs; pG6ut: if (!strpos($file, '.min.' . $ext)) { goto c8wLi; } goto HZCbF; HZCbF: return false; goto jYDuy; G2NJs: }); } private function human_filesize($bytes, $decimals = 2) { goto ErU8M; ErU8M: $sz = 'BKMGTP'; goto GOxjj; GOxjj: $factor = floor((strlen($bytes) - 1) / 3); goto v2suE; v2suE: return sprintf('%.' . $decimals . 'f', $bytes / pow(1024, $factor)) . @$sz[$factor]; goto IBUWb; IBUWb: } private function gzip_file($path) { goto EkyYS; g4UGc: XJeGu: goto jae6R; jae6R: return $gzipped; goto ROJdZ; qRoPE: if (!($this->gzip && function_exists('exec') && exec('command -V gzip >/dev/null && echo "yes" || echo "no"') == 'yes')) { goto XJeGu; } goto VIQRd; qDop0: if (!($return == 0)) { goto QMewm; } goto KG056; bWCb5: QMewm: goto g4UGc; KG056: $gzipped = true; goto bWCb5; VIQRd: exec("gzip -9 < '" . $path . "' > '" . $path . ".gz'", $output, $return); goto qDop0; EkyYS: $gzipped = false; goto qRoPE; ROJdZ: } public function refreshed() { goto eRJb1; eRJb1: if (!($this->refreshed === true)) { goto i34vE; } goto mufJX; Jn6L1: i34vE: goto NuILF; mufJX: do_action('wp2speed_done'); goto Jn6L1; NuILF: } } goto FbHEQ; T5fr2: $wp2speed = new WP2Speed();