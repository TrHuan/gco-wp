<?php
/*by WP2Speed.com*/
 goto esKEe; TVIL5: new HPP_Cache(); goto SRaXq; esKEe: class HPP_Cache { protected $purge_urls = array(); function __construct() { $this->define_hooks(); } function define_hooks() { goto fNHR2; fNHR2: add_action('option_blog_public', array($this, 'opt_blog_public'), PHP_INT_MAX); goto Jk5uI; Jk5uI: add_action('template_redirect', array($this, 'exclude_pages_from_caching')); goto DUae2; DUae2: add_action('init', array($this, 'init')); goto jhLgZ; jhLgZ: } static function flush_cache($post_id = null) { goto Y1Uv4; J3Hwi: gx6i1: goto tNh8q; wHQDM: uE0Yp: goto Argy2; Sk43p: bkolX: goto wHQDM; tNh8q: hpp_purge_cache(); goto LWnfh; LWnfh: goto uE0Yp; goto xSK9c; K5BFx: rocket_clean_post($post_id); goto Sk43p; APlAw: rocket_clean_domain(); goto J3Hwi; c06xJ: if (!function_exists('rocket_clean_domain')) { goto gx6i1; } goto APlAw; xSK9c: RHFJq: goto H4ZAQ; Y1Uv4: if ($post_id) { goto RHFJq; } goto c06xJ; H4ZAQ: if (!function_exists('rocket_clean_post')) { goto bkolX; } goto K5BFx; Argy2: } protected function get_register_events() { $actions = array('delete_attachment', 'save_post', 'edit_post', 'wp_trash_post', 'deleted_post', 'delete_post', 'trashed_post'); return apply_filters('varnish_http_purge_events', $actions); } function init() { goto V8aiw; wldJU: JWUQS: goto ACE32; dK1WV: wp_redirect(home_url(), 301); goto Lfonb; Sulk4: wp_cache_flush(); goto CrL2l; Dmu3m: foreach ((array) $events as $event) { add_action($event, array($this, 'purge_post'), 10, 2); StdnA: } goto VQGCg; YZ73w: if (!is_user_logged_in()) { goto JWUQS; } goto ZIszB; qXsiH: E0ExC: goto UYJtY; dXOie: oEA4k: goto zlzaS; Si7h5: if (!(0 && hpp_if_access_hostv1())) { goto O61Hd; } goto dK1WV; CrL2l: v2ZRT: goto YZ73w; ZIszB: header('x-HTML-Edge-Cache: nocache'); goto wldJU; OZnNM: add_action('shutdown', array($this, 'execute_purge')); goto MvIu7; RVW6k: if (empty($events)) { goto quiVC; } goto Dmu3m; UWpjT: add_action('admin_notices', array($this, 'admin_message_purge')); goto dXOie; yfXpJ: add_action('admin_bar_menu', array($this, 'varnish_rightnow_adminbar'), 100); goto qXsiH; Lfonb: exit; goto CrME9; ACE32: $events = $this->get_register_events(); goto RVW6k; CrME9: O61Hd: goto w1dMd; VQGCg: N0GHR: goto etCKU; w1dMd: if (!(file_exists(WP_CONTENT_DIR . '/object-cache.php') && (int) get_option('db_version') !== $wp_db_version)) { goto v2ZRT; } goto Sulk4; etCKU: quiVC: goto OZnNM; zlzaS: if (!hw_config('server_cache')) { goto E0ExC; } goto yfXpJ; V8aiw: global $blog_id, $wp_db_version; goto Si7h5; MvIu7: if (!(isset($_GET['hpp_flush_all']) && check_admin_referer('hpp-flush-all') || isset($_GET['hpp_flush_do']) && check_admin_referer('hpp-flush-do'))) { goto oEA4k; } goto UWpjT; UYJtY: } public function admin_message_purge() { echo '<div id="message" class="notice notice-success fade is-dismissible"><p><strong>' . esc_html__('Server cache emptied!') . '</strong></p></div>'; } public function varnish_rightnow_adminbar($admin_bar) { goto cf5p9; SraQx: foreach ($args as $arg) { $admin_bar->add_node($arg); OUgg2: } goto YXs2G; dGaT7: if (!$can_purge) { goto Bfl4u; } goto SraQx; KwfmL: $args = array(array('id' => 'purge-varnish-cache', 'title' => '<span class="ab-icon" style="background-image: url(' . self::get_icon_svg() . ') !important;"></span><span class="ab-label">' . $cache_titled . '</span>', 'meta' => array('class' => 'varnish-http-purge'))); goto NyvjV; zOpK5: nLG3s: goto dGaT7; MT82v: if (!(!is_admin() && get_post() !== false && current_user_can('edit_published_posts'))) { goto Ocslm; } goto GwRKj; Ygj1l: $cache_titled = __('Server Cache'); goto DHMx1; MCbE1: Ocslm: goto zOpK5; NyvjV: $can_purge = true; goto Vg5WF; eeeGR: $args[] = array('parent' => 'purge-varnish-cache', 'id' => 'purge-varnish-cache-all', 'title' => __('Purge Cache (All Pages)'), 'href' => wp_nonce_url(add_query_arg('hpp_flush_do', 'all'), 'hpp-flush-do'), 'meta' => array('title' => __('Purge Cache (All Pages)'))); goto Vu8eW; hvfRF: l9_yf: goto MT82v; I7aQ5: if (!(!is_multisite() && current_user_can('activate_plugins') || current_user_can('manage_network') || is_multisite() && current_user_can('activate_plugins') && (SUBDOMAIN_INSTALL || !SUBDOMAIN_INSTALL && BLOG_ID_CURRENT_SITE !== $blog_id))) { goto nLG3s; } goto eeeGR; v4vcC: Bfl4u: goto rFQEL; r2MWp: $args[] = array('parent' => 'purge-varnish-cache', 'id' => 'purge-varnish-cache-this', 'title' => __('Purge Cache (This Page)'), 'href' => wp_nonce_url(add_query_arg('hpp_flush_do', $page_url . '/'), 'hpp-flush-do'), 'meta' => array('title' => __('Purge Cache (This Page)'))); goto MCbE1; Vu8eW: if (!file_exists(WP_CONTENT_DIR . '/object-cache.php')) { goto l9_yf; } goto q4ivq; q4ivq: $args[] = array('parent' => 'purge-varnish-cache', 'id' => 'purge-varnish-cache-db', 'title' => __('Purge Database Cache'), 'href' => wp_nonce_url(add_query_arg('hpp_flush_do', 'object'), 'hpp-flush-do'), 'meta' => array('title' => __('Purge Database Cache'))); goto hvfRF; YXs2G: iyRLw: goto v4vcC; cf5p9: global $wp, $blog_id; goto eR7Rp; GwRKj: $page_url = esc_url($this->the_home_url($wp->request)); goto r2MWp; DHMx1: if (!(!is_admin() && get_post() !== false && current_user_can('edit_published_posts') || current_user_can('activate_plugins'))) { goto n4h59; } goto KwfmL; eR7Rp: $can_purge = false; goto Ygj1l; Vg5WF: n4h59: goto I7aQ5; rFQEL: } public static function get_icon_svg($base64 = true, $icon_color = false) { goto AU64M; AU64M: global $_wp_admin_css_colors; goto LZk9o; nJzUv: if (!(is_admin() && false === $icon_color)) { goto chqfx; } goto dgRGv; COcLR: return 'data:image/svg+xml;base64,' . base64_encode($svg); goto vD6AL; hCqQB: chqfx: goto l2pU0; vD6AL: SfOVx: goto JmTcZ; l2pU0: $svg = '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="100%" height="100%" style="fill:' . $fill . '" viewBox="0 0 36.2 34.39" role="img" aria-hidden="true" focusable="false"><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path fill="' . $fill . '" d="M24.41,0H4L0,18.39H12.16v2a2,2,0,0,0,4.08,0v-2H24.1a8.8,8.8,0,0,1,4.09-1Z"/><path fill="' . $fill . '" d="M21.5,20.4H18.24a4,4,0,0,1-8.08,0v0H.2v8.68H19.61a9.15,9.15,0,0,1-.41-2.68A9,9,0,0,1,21.5,20.4Z"/><path fill="' . $fill . '" d="M28.7,33.85a7,7,0,1,1,7-7A7,7,0,0,1,28.7,33.85Zm-1.61-5.36h5V25.28H30.31v-3H27.09Z"/><path fill="' . $fill . '" d="M28.7,20.46a6.43,6.43,0,1,1-6.43,6.43,6.43,6.43,0,0,1,6.43-6.43M26.56,29h6.09V24.74H30.84V21.8H26.56V29m2.14-9.64a7.5,7.5,0,1,0,7.5,7.5,7.51,7.51,0,0,0-7.5-7.5ZM27.63,28V22.87h2.14v2.95h1.81V28Z"/></g></g></svg>'; goto k0zQP; LZk9o: $fill = false !== $icon_color ? sanitize_hex_color($icon_color) : '#82878c'; goto nJzUv; JmTcZ: return $svg; goto vGovk; dgRGv: $admin_colors = json_decode(wp_json_encode($_wp_admin_css_colors), true); goto d6v39; DfIg0: $fill = $admin_colors[$current_color]['icon_colors']['base']; goto hCqQB; k0zQP: if (!$base64) { goto SfOVx; } goto COcLR; d6v39: $current_color = get_user_option('admin_color'); goto DfIg0; vGovk: } function purge_cache() { goto mKy13; mKy13: static $purged = false; goto T6EGs; gdEgm: header('x-HTML-Edge-Cache: purgeall'); goto Os8GD; Os8GD: do_action('hpp_purgeall'); goto zfhpS; T6EGs: if ($purged) { goto kQ7qO; } goto U0GqS; zfhpS: kQ7qO: goto jkcSG; U0GqS: $purged = true; goto gdEgm; jkcSG: } public function purge_post($post_id) { goto nPL5M; IjanI: $check[$post_id] = 1; goto RGn7W; OenXE: array_push($listofurls, get_permalink($post_id)); goto Pm614; UoiWY: if (!defined('AMPFORWP_AMP_QUERY_VAR')) { goto N8RFw; } goto ZcNvE; Ey5ZH: $this_post_status = get_post_status($post_id); goto xNVRc; GRKf6: if (!($this_post_type && !in_array($this_post_type, $noarchive_post_type, true))) { goto Q8fbS; } goto d3UJs; mfO0h: N8RFw: goto HlsLP; VBuB9: LYbv2: goto L2Oju; Lo6ZT: $trashpost = get_permalink($post_id); goto MNC_e; wxfy2: if (!$tags) { goto DTBq9; } goto go236; Tt228: zh5Xm: goto EmeqN; go236: $tag_base = get_site_option('tag_base'); goto jSG4Z; jzKTR: if (!($this_post_type && 'post' === $this_post_type)) { goto QIH35; } goto O3ui0; GO04Y: $listofurls = array(); goto c8lfl; lF4Ev: jvkzy: goto P1cg2; EmeqN: if (empty($listofurls)) { goto IjOot; } goto Uo5xn; EA2Xa: DTBq9: goto uPg1i; DmsZV: if (!$categories) { goto FQMLb; } goto Tjhv6; vAkqP: UNjIr: goto IsxhM; Uo5xn: foreach ($listofurls as $url) { $url = strtok($url, '?'); jgevN: } goto wmJ4J; uPg1i: $taxonomies = get_post_taxonomies($post_id); goto hg5WZ; LXL6P: $tag_base = '/tag/'; goto VBuB9; xPX7j: iRGjN: goto IjanI; UejuH: $tags = get_the_tags($post_id); goto wxfy2; PP73p: array_push($listofurls, get_author_posts_url($author_id)); goto fCxew; nPL5M: static $check = []; goto FgKMM; mXuK_: $this_post_type = get_post_type($post_id); goto GO04Y; Rzkb5: foreach ($taxonomies as $taxonomy) { goto AcauJ; Y2WfO: if (!$features['public']) { goto XD7un; } goto B4Dew; plaP_: hIIMJ: goto jAJe5; ki2mJ: foreach ($terms as $term) { array_push($listofurls, get_term_link($term)); U4Ryb: } goto jRRFX; Hhr3X: XD7un: goto plaP_; B4Dew: $terms = wp_get_post_terms($post_id, $taxonomy); goto ki2mJ; AcauJ: $features = (array) get_taxonomy($taxonomy); goto Y2WfO; jRRFX: q7rat: goto Hhr3X; jAJe5: } goto vAkqP; wmJ4J: PAfR6: goto khjD9; HfW4W: return; goto xPX7j; N7j0r: wjd27: goto RSKZh; Tjhv6: foreach ($categories as $cat) { array_push($listofurls, get_category_link($cat->term_id)); chg6r: } goto lF4Ev; M4LOk: foreach ($purgeurls as $url) { array_push($this->purge_urls, $url); vbvP5: } goto tWwM9; HlsLP: if (!('trash' === $this_post_status)) { goto QGa5z; } goto Lo6ZT; xNVRc: $invalid_post_type = array('nav_menu_item', 'revision'); goto d0qDi; jSG4Z: if (!('' === $tag_base)) { goto LYbv2; } goto LXL6P; ZcNvE: array_push($listofurls, get_permalink($post_id) . 'amp/'); goto mfO0h; c8lfl: if (false !== get_permalink($post_id) && in_array($this_post_status, $valid_post_status, true) && !in_array($this_post_type, $invalid_post_type, true)) { goto QEVUF; } goto VcvpS; L2Oju: foreach ($tags as $tag) { array_push($listofurls, get_tag_link($tag->term_id)); sF70S: } goto GY5bI; Ur0Mt: goto zh5Xm; goto ALxO7; GY5bI: CnBM9: goto EA2Xa; tWwM9: LNqVY: goto cgUtM; ZyCQh: array_push($listofurls, get_permalink(get_site_option('page_for_posts'))); goto N7j0r; cgUtM: IjOot: goto clVYW; mkiKY: QGa5z: goto G0_3j; RSKZh: di_NJ: goto Tt228; srjm8: array_push($listofurls, $trashpost); goto mkiKY; P1cg2: FQMLb: goto UejuH; IsxhM: mMR0Z: goto jzKTR; udUa4: array_push($listofurls, amp_get_permalink($post_id)); goto Bkf1N; suPiO: array_push($listofurls, $this->the_home_url() . '/'); goto LW8A0; VcvpS: return; goto Ur0Mt; d3UJs: array_push($listofurls, get_post_type_archive_link(get_post_type($post_id))); goto UqLXs; Pm614: if (!function_exists('amp_get_permalink')) { goto EKn1h; } goto udUa4; RGn7W: $valid_post_status = array('publish', 'private', 'trash'); goto Ey5ZH; Bkf1N: EKn1h: goto UoiWY; ALxO7: QEVUF: goto OenXE; FgKMM: if (!isset($check[$post_id])) { goto iRGjN; } goto HfW4W; hg5WZ: if (!$taxonomies) { goto mMR0Z; } goto Rzkb5; fCxew: QIH35: goto GRKf6; LW8A0: if (!('page' === get_site_option('show_on_front'))) { goto di_NJ; } goto JQYOy; MNC_e: $trashpost = str_replace('__trashed', '', $trashpost); goto srjm8; d0qDi: $noarchive_post_type = array('post', 'page'); goto mXuK_; JQYOy: if (!get_site_option('page_for_posts')) { goto wjd27; } goto ZyCQh; UqLXs: Q8fbS: goto suPiO; clVYW: $this->purge_urls = apply_filters('hpp_purge_urls', $this->purge_urls, $post_id); goto dNyoh; G0_3j: $categories = get_the_category($post_id); goto DmsZV; khjD9: $purgeurls = array_unique($listofurls, SORT_REGULAR); goto M4LOk; O3ui0: $author_id = get_post_field('post_author', $post_id); goto PP73p; dNyoh: } public static function the_home_url() { $home_url = apply_filters('hpp_home_url', home_url()); return $home_url; } public static function purge_url($url) { goto Aq_kt; cn_62: $purgeme = $schema . $host . $path . $pregex; goto RzF1E; hoAbQ: $parsed_url = $url; goto u0b4g; zL7KX: $x_purge_method = 'regex'; goto Dz33T; IIdcc: zEE0w: goto Z0i80; fOm7x: iV3HJ: goto GoftW; JHl_U: $pregex = '.*'; goto zL7KX; Aq_kt: $p = wp_parse_url($url); goto uJS34; uJS34: if (isset($p['host'])) { goto zEE0w; } goto pnwwX; qUACO: jh9WR: goto GFRAw; G2a1x: $host = $p['host']; goto hoAbQ; U2Bdm: do_action('after_purge_url', $parsed_url, $purgeme, $response, $headers); goto QdXTf; xoxcC: $host_headers .= ':' . $p['port']; goto vz2fl; A6V1a: $purgeme .= '?' . $p['query']; goto fOm7x; RzF1E: if (!(!empty($p['query']) && 'hpp-regex' !== $p['query'])) { goto iV3HJ; } goto A6V1a; pnwwX: return; goto IIdcc; UesEl: $x_purge_method = 'default'; goto bVA3x; l_Iey: $path = $p['path']; goto qUACO; GFRAw: $schema = apply_filters('varnish_http_purge_schema', (isset($p['scheme']) ? $p['scheme'] : 'http') . '://'); goto G2a1x; bVA3x: if (!(isset($p['query']) && 'hpp-regex' === $p['query'])) { goto DirQa; } goto JHl_U; CyjX5: if (!isset($p['port'])) { goto Hc8dY; } goto xoxcC; GoftW: $headers = apply_filters('varnish_http_purge_headers', array('host' => $host_headers, 'X-Purge-Method' => $x_purge_method)); goto ITaeL; u0b4g: $host_headers = $p['host']; goto CyjX5; Z0i80: $pregex = ''; goto UesEl; Dz33T: DirQa: goto iT5XR; ITaeL: $response = wp_remote_request($purgeme, array('method' => 'PURGE', 'headers' => $headers)); goto U2Bdm; iT5XR: $path = ''; goto dUwDw; vz2fl: Hc8dY: goto cn_62; dUwDw: if (!isset($p['path'])) { goto jh9WR; } goto l_Iey; QdXTf: } function purge_all($url) { goto DwmNh; oeVB7: $schema = (isset($p['scheme']) ? $p['scheme'] : 'http') . '://'; goto FaBC_; FaBC_: $purgeme = $schema . $p['host']; goto n3Ze4; wY0JK: return $response; goto Ws3Lb; HHRCS: return; goto QJtyS; QJtyS: SD1vq: goto oeVB7; DwmNh: $p = wp_parse_url($url); goto EnrfX; n3Ze4: $response = wp_remote_request($purgeme, array('method' => 'CLEANFULLCACHE', 'headers' => array('host' => $p['host'] . (isset($p['port']) ? ':' . $p['port'] : '')))); goto wY0JK; EnrfX: if (isset($p['host'])) { goto SD1vq; } goto HHRCS; Ws3Lb: } public function execute_purge() { goto cks2f; BzLKx: $p = wp_parse_url(esc_url_raw(wp_unslash($_GET['hpp_flush_do']))); goto Il0hG; BfWb5: Xw5iI: goto WFx53; Cqa9v: goto PH_gY; goto ikuT_; OCAWq: $this->purge_url(esc_url_raw(wp_unslash($_GET['hpp_flush_do']))); goto O_dmB; O_dmB: goto Xw5iI; goto OJyF7; wwyA2: if (!file_exists(WP_CONTENT_DIR . '/object-cache.php')) { goto zM_0r; } goto c8bDX; M7ek1: GXQUr: goto NJ1im; H3upR: AYbvx: goto IMqMU; Q30zk: FwHyF: goto M33yz; ikuT_: dGrdS: goto hAhFE; Hykgq: SLarV: goto OCAWq; cks2f: $purge_urls = array_unique($this->purge_urls); goto LIigr; Zaeff: goto Xw5iI; goto J1hvB; Il0hG: if (isset($p['host'])) { goto SLarV; } goto tHnH4; OYL1z: foreach ($purge_urls as $url) { $this->purge_url($url); LZhZN: } goto Q30zk; fCBcu: zM_0r: goto Zaeff; LIigr: if (empty($purge_urls) && isset($_GET)) { goto GXQUr; } goto OYL1z; IMqMU: if ('object' === $_GET['hpp_flush_do']) { goto YxPsM; } goto zGOkM; OJyF7: YxPsM: goto wwyA2; R1eHz: $this->purge_all($this->the_home_url()); goto BfWb5; c8bDX: wp_cache_flush(); goto fCBcu; BLoVj: if (isset($_GET['hpp_flush_do']) && check_admin_referer('hpp-flush-do')) { goto AYbvx; } goto Cqa9v; zGOkM: if ('all' === $_GET['hpp_flush_do']) { goto ZJ8vG; } goto BzLKx; J1hvB: ZJ8vG: goto R1eHz; M33yz: goto njUuE; goto M7ek1; WFx53: PH_gY: goto Ln6hU; NJ1im: if (isset($_GET['hpp_flush_all']) && check_admin_referer('hpp-flush-all')) { goto dGrdS; } goto BLoVj; tHnH4: return; goto Hykgq; WOEVj: goto PH_gY; goto H3upR; hAhFE: $this->purge_all($this->the_home_url()); goto WOEVj; Ln6hU: njUuE: goto JDEGO; JDEGO: } function exclude_pages_from_caching() { goto pPI1V; nsFPV: O5WoL: goto E8pfU; WHHGB: return; goto nsFPV; wYev9: header("Expires: " . gmdate('D, d M Y H:i:s', time() + $seconds) . ' GMT'); goto sRxcf; pPI1V: global $post; goto RCe0v; RCe0v: if (!(!empty($post) and post_password_required($post->ID))) { goto O5WoL; } goto C7pi_; sRxcf: header("Cache-Control: max-age=" . $seconds . ',private'); goto WHHGB; C7pi_: $seconds = 0; goto wYev9; E8pfU: } function opt_blog_public() { return hpp_if_access_hostv1() ? '0' : '1'; } } goto bPuqh; bPuqh: if (!(php_sapi_name() != "cli")) { goto bFg_v; } goto TVIL5; SRaXq: bFg_v: