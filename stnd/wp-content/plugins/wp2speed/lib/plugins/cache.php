<?php
/*by PenciDesign*/
 goto ObEWt; i0932: new HPP_Cache(); goto Nyirv; mKQae: if (!(php_sapi_name() != "cli")) { goto VqASA; } goto i0932; ObEWt: class HPP_Cache { protected $purge_urls = array(); function __construct() { $this->define_hooks(); } function define_hooks() { goto Y2KM8; Y2KM8: add_action('option_blog_public', array($this, 'opt_blog_public'), PHP_INT_MAX); goto GP360; PiXAF: add_action('init', array($this, 'init')); goto m9HqE; GP360: add_action('template_redirect', array($this, 'exclude_pages_from_caching')); goto PiXAF; m9HqE: } static function flush_cache($post_id = null) { goto V_E8Z; AH2qk: if (!function_exists('rocket_clean_domain')) { goto I3lZu; } goto nbPv3; eGofH: Zvkrg: goto XiI1c; KQzti: I3lZu: goto SlP6d; SlP6d: hpp_purge_cache(); goto mgI5B; mgI5B: goto EVVGA; goto eGofH; w6HXe: rocket_clean_post($post_id); goto PGjBF; V_E8Z: if ($post_id) { goto Zvkrg; } goto AH2qk; nbPv3: rocket_clean_domain(); goto KQzti; XiI1c: if (!function_exists('rocket_clean_post')) { goto VgmrZ; } goto w6HXe; PGjBF: VgmrZ: goto rLj8Q; rLj8Q: EVVGA: goto VKncz; VKncz: } protected function get_register_events() { $actions = array('delete_attachment', 'save_post', 'edit_post', 'wp_trash_post', 'deleted_post', 'delete_post', 'trashed_post'); return apply_filters('varnish_http_purge_events', $actions); } function init() { goto fhSHW; MwoRt: wrOp0: goto P7FTT; TFBNF: if (empty($events)) { goto onn7G; } goto oIhmJ; Ev5oS: add_action('admin_notices', array($this, 'admin_message_purge')); goto VbcZ8; Y8YCU: A7qc5: goto L7GuC; vvheX: add_action('shutdown', array($this, 'execute_purge')); goto vhGqf; CQuOS: xuZMW: goto focpF; mYPPr: if (!(file_exists(WP_CONTENT_DIR . '/object-cache.php') && (int) get_option('db_version') !== $wp_db_version)) { goto wrOp0; } goto NcnW7; NcnW7: wp_cache_flush(); goto MwoRt; xEv5r: oY5TY: goto dkbhi; VbcZ8: axMs4: goto f2edL; N7VO1: if (!(0 && hpp_if_access_hostv1())) { goto Z0CxL; } goto QlCrT; P7FTT: if (!is_user_logged_in()) { goto oY5TY; } goto IIyHU; f2edL: if (!hw_config('server_cache')) { goto A7qc5; } goto iiPhc; iiPhc: add_action('admin_bar_menu', array($this, 'varnish_rightnow_adminbar'), 100); goto Y8YCU; oIhmJ: foreach ((array) $events as $event) { add_action($event, array($this, 'purge_post'), 10, 2); LavJA: } goto CQuOS; vhGqf: if (!(isset($_GET['hpp_flush_all']) && check_admin_referer('hpp-flush-all') || isset($_GET['hpp_flush_do']) && check_admin_referer('hpp-flush-do'))) { goto axMs4; } goto Ev5oS; zpFz4: Z0CxL: goto mYPPr; IIyHU: header('x-HTML-Edge-Cache: nocache'); goto xEv5r; ZWdse: exit; goto zpFz4; QlCrT: wp_redirect(home_url(), 301); goto ZWdse; fhSHW: global $blog_id, $wp_db_version; goto N7VO1; dkbhi: $events = $this->get_register_events(); goto TFBNF; focpF: onn7G: goto vvheX; L7GuC: } public function admin_message_purge() { echo '<div id="message" class="notice notice-success fade is-dismissible"><p><strong>' . esc_html__('Server cache emptied!') . '</strong></p></div>'; } public function varnish_rightnow_adminbar($admin_bar) { goto laTYl; pKqzE: VsyRu: goto xPUA4; kpyhi: foreach ($args as $arg) { $admin_bar->add_node($arg); FxwzO: } goto pKqzE; PJnc7: $args[] = array('parent' => 'purge-varnish-cache', 'id' => 'purge-varnish-cache-this', 'title' => __('Purge Cache (This Page)'), 'href' => wp_nonce_url(add_query_arg('hpp_flush_do', $page_url . '/'), 'hpp-flush-do'), 'meta' => array('title' => __('Purge Cache (This Page)'))); goto sV1TG; U2QBQ: if (!(!is_admin() && get_post() !== false && current_user_can('edit_published_posts') || current_user_can('activate_plugins'))) { goto me8Ww; } goto B04at; llQWI: $can_purge = false; goto CiRbB; sV1TG: So_GP: goto TTUhq; Cxz9a: if (!$can_purge) { goto TecX2; } goto kpyhi; B04at: $args = array(array('id' => 'purge-varnish-cache', 'title' => '<span class="ab-icon" style="background-image: url(' . self::get_icon_svg() . ') !important;"></span><span class="ab-label">' . $cache_titled . '</span>', 'meta' => array('class' => 'varnish-http-purge'))); goto d2ytw; TTUhq: uhGRR: goto Cxz9a; xPUA4: TecX2: goto bYEue; d2ytw: $can_purge = true; goto H8SnH; laTYl: global $wp, $blog_id; goto llQWI; WktNp: if (!(!is_admin() && get_post() !== false && current_user_can('edit_published_posts'))) { goto So_GP; } goto ntve4; ntve4: $page_url = esc_url($this->the_home_url($wp->request)); goto PJnc7; CiRbB: $cache_titled = __('Server Cache'); goto U2QBQ; aWOmH: if (!file_exists(WP_CONTENT_DIR . '/object-cache.php')) { goto MLTAS; } goto wig7e; nAvfQ: if (!(!is_multisite() && current_user_can('activate_plugins') || current_user_can('manage_network') || is_multisite() && current_user_can('activate_plugins') && (SUBDOMAIN_INSTALL || !SUBDOMAIN_INSTALL && BLOG_ID_CURRENT_SITE !== $blog_id))) { goto uhGRR; } goto gojcZ; gojcZ: $args[] = array('parent' => 'purge-varnish-cache', 'id' => 'purge-varnish-cache-all', 'title' => __('Purge Cache (All Pages)'), 'href' => wp_nonce_url(add_query_arg('hpp_flush_do', 'all'), 'hpp-flush-do'), 'meta' => array('title' => __('Purge Cache (All Pages)'))); goto aWOmH; wig7e: $args[] = array('parent' => 'purge-varnish-cache', 'id' => 'purge-varnish-cache-db', 'title' => __('Purge Database Cache'), 'href' => wp_nonce_url(add_query_arg('hpp_flush_do', 'object'), 'hpp-flush-do'), 'meta' => array('title' => __('Purge Database Cache'))); goto Fp017; Fp017: MLTAS: goto WktNp; H8SnH: me8Ww: goto nAvfQ; bYEue: } public static function get_icon_svg($base64 = true, $icon_color = false) { goto gzhU9; dp88J: $fill = false !== $icon_color ? sanitize_hex_color($icon_color) : '#82878c'; goto zgqd3; nBFL3: return 'data:image/svg+xml;base64,' . base64_encode($svg); goto ds2_P; gzhU9: global $_wp_admin_css_colors; goto dp88J; R7UOz: $fill = $admin_colors[$current_color]['icon_colors']['base']; goto yQlYj; Zg1Jb: $current_color = get_user_option('admin_color'); goto R7UOz; ds2_P: jVygU: goto evRBk; zgqd3: if (!(is_admin() && false === $icon_color)) { goto rxvZ_; } goto Ikv9P; FNPsc: $svg = '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="100%" height="100%" style="fill:' . $fill . '" viewBox="0 0 36.2 34.39" role="img" aria-hidden="true" focusable="false"><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path fill="' . $fill . '" d="M24.41,0H4L0,18.39H12.16v2a2,2,0,0,0,4.08,0v-2H24.1a8.8,8.8,0,0,1,4.09-1Z"/><path fill="' . $fill . '" d="M21.5,20.4H18.24a4,4,0,0,1-8.08,0v0H.2v8.68H19.61a9.15,9.15,0,0,1-.41-2.68A9,9,0,0,1,21.5,20.4Z"/><path fill="' . $fill . '" d="M28.7,33.85a7,7,0,1,1,7-7A7,7,0,0,1,28.7,33.85Zm-1.61-5.36h5V25.28H30.31v-3H27.09Z"/><path fill="' . $fill . '" d="M28.7,20.46a6.43,6.43,0,1,1-6.43,6.43,6.43,6.43,0,0,1,6.43-6.43M26.56,29h6.09V24.74H30.84V21.8H26.56V29m2.14-9.64a7.5,7.5,0,1,0,7.5,7.5,7.51,7.51,0,0,0-7.5-7.5ZM27.63,28V22.87h2.14v2.95h1.81V28Z"/></g></g></svg>'; goto lYE8i; Ikv9P: $admin_colors = json_decode(wp_json_encode($_wp_admin_css_colors), true); goto Zg1Jb; lYE8i: if (!$base64) { goto jVygU; } goto nBFL3; yQlYj: rxvZ_: goto FNPsc; evRBk: return $svg; goto KLEmi; KLEmi: } function purge_cache() { goto J3Vjc; J3Vjc: static $purged = false; goto dKy4I; dKy4I: if ($purged) { goto WEUjL; } goto JbpO5; HYNn1: do_action('hpp_purgeall'); goto VTEH0; JbpO5: $purged = true; goto fSWx3; VTEH0: WEUjL: goto VPyyY; fSWx3: header('x-HTML-Edge-Cache: purgeall'); goto HYNn1; VPyyY: } public function purge_post($post_id) { goto HLq2J; Dpmdv: if (!$tags) { goto w2M1z; } goto My_Xe; Bkyu3: array_push($listofurls, amp_get_permalink($post_id)); goto nmxw0; WFXPy: array_push($listofurls, get_permalink($post_id)); goto D_Cgr; WsVlQ: if (!('page' === get_site_option('show_on_front'))) { goto Ubvd4; } goto aD0rz; ovvfL: foreach ($purgeurls as $url) { array_push($this->purge_urls, $url); QNQi5: } goto f3FC6; kmmq9: array_push($listofurls, $trashpost); goto mp4qd; N4Vib: kJJC7: goto WFXPy; xDxhu: pHPDa: goto eQgxb; nmxw0: jPR5C: goto vjvXq; EiTrw: lXtcm: goto ptXLF; fnP2Y: array_push($listofurls, get_post_type_archive_link(get_post_type($post_id))); goto dYNeQ; Nw_l8: foreach ($listofurls as $url) { $url = strtok($url, '?'); SY1dg: } goto vm3VG; f3FC6: OKFK6: goto ogzQG; ogzQG: bertS: goto jU82D; RcrQC: $taxonomies = get_post_taxonomies($post_id); goto jaW0u; hHcGt: $tag_base = '/tag/'; goto sIeaU; lmhDM: Ubvd4: goto QOQcN; CIKzr: $this_post_status = get_post_status($post_id); goto omfpc; eQgxb: $tags = get_the_tags($post_id); goto Dpmdv; aodMc: E9Gcq: goto xDxhu; wQ1pa: w2M1z: goto RcrQC; D_Cgr: if (!function_exists('amp_get_permalink')) { goto jPR5C; } goto Bkyu3; HBHFT: if (!($this_post_type && !in_array($this_post_type, $noarchive_post_type, true))) { goto Bnqdz; } goto fnP2Y; Y6bty: $trashpost = get_permalink($post_id); goto ErB5w; RVfAS: return; goto HFKs4; gjNpU: if (!$categories) { goto pHPDa; } goto Fn7f3; FpkAu: $this_post_type = get_post_type($post_id); goto ZL21v; adSWn: $categories = get_the_category($post_id); goto gjNpU; ptXLF: if (!($this_post_type && 'post' === $this_post_type)) { goto i1BWL; } goto OnrcN; QBaLr: Ykx3x: goto wQ1pa; LRDuh: if (!('trash' === $this_post_status)) { goto gi60b; } goto Y6bty; kwF5j: return; goto F0elK; KsZ6F: if (!('' === $tag_base)) { goto Mid45; } goto hHcGt; exHpq: $purgeurls = array_unique($listofurls, SORT_REGULAR); goto ovvfL; aD0rz: if (!get_site_option('page_for_posts')) { goto R9oLa; } goto mAAXd; sIeaU: Mid45: goto vkmC3; vkmC3: foreach ($tags as $tag) { array_push($listofurls, get_tag_link($tag->term_id)); Wq054: } goto QBaLr; fGxwE: $noarchive_post_type = array('post', 'page'); goto FpkAu; Ub_Pn: $valid_post_status = array('publish', 'private', 'trash'); goto CIKzr; I4rDA: array_push($listofurls, get_author_posts_url($author_id)); goto EZYck; mp4qd: gi60b: goto adSWn; smXJ9: array_push($listofurls, get_permalink($post_id) . 'amp/'); goto Cj_PW; Kzx4A: R9oLa: goto lmhDM; My_Xe: $tag_base = get_site_option('tag_base'); goto KsZ6F; BrLJU: $check[$post_id] = 1; goto Ub_Pn; neiCg: cMGG9: goto EiTrw; ErB5w: $trashpost = str_replace('__trashed', '', $trashpost); goto kmmq9; QDt2n: if (false !== get_permalink($post_id) && in_array($this_post_status, $valid_post_status, true) && !in_array($this_post_type, $invalid_post_type, true)) { goto kJJC7; } goto kwF5j; BDfQ3: if (!isset($check[$post_id])) { goto G5ayz; } goto RVfAS; omfpc: $invalid_post_type = array('nav_menu_item', 'revision'); goto fGxwE; X457x: foreach ($taxonomies as $taxonomy) { goto T_Ywl; Isg_W: desWe: goto kecul; kX_ai: foreach ($terms as $term) { array_push($listofurls, get_term_link($term)); lQkK5: } goto x8029; T_Ywl: $features = (array) get_taxonomy($taxonomy); goto IsleY; ol9Hp: $terms = wp_get_post_terms($post_id, $taxonomy); goto kX_ai; kecul: GS92_: goto vfWNp; IsleY: if (!$features['public']) { goto desWe; } goto ol9Hp; x8029: CTjNZ: goto Isg_W; vfWNp: } goto neiCg; HFKs4: G5ayz: goto BrLJU; F0elK: goto k1xB3; goto N4Vib; jaW0u: if (!$taxonomies) { goto lXtcm; } goto X457x; QOQcN: k1xB3: goto D8jnj; u66g8: array_push($listofurls, $this->the_home_url() . '/'); goto WsVlQ; ZL21v: $listofurls = array(); goto QDt2n; OnrcN: $author_id = get_post_field('post_author', $post_id); goto I4rDA; vm3VG: kWg2s: goto exHpq; jU82D: $this->purge_urls = apply_filters('hpp_purge_urls', $this->purge_urls, $post_id); goto kvZf0; Fn7f3: foreach ($categories as $cat) { array_push($listofurls, get_category_link($cat->term_id)); nbP7n: } goto aodMc; EZYck: i1BWL: goto HBHFT; vjvXq: if (!defined('AMPFORWP_AMP_QUERY_VAR')) { goto wYP9c; } goto smXJ9; HLq2J: static $check = []; goto BDfQ3; mAAXd: array_push($listofurls, get_permalink(get_site_option('page_for_posts'))); goto Kzx4A; Cj_PW: wYP9c: goto LRDuh; dYNeQ: Bnqdz: goto u66g8; D8jnj: if (empty($listofurls)) { goto bertS; } goto Nw_l8; kvZf0: } public static function the_home_url() { $home_url = apply_filters('hpp_home_url', home_url()); return $home_url; } public static function purge_url($url) { goto ge360; fmMTA: if (!isset($p['path'])) { goto tZNsx; } goto mqE67; VF_cc: $pregex = ''; goto XVOzc; mqE67: $path = $p['path']; goto vjpYM; vjpYM: tZNsx: goto yorhX; UFRtA: $purgeme = $schema . $host . $path . $pregex; goto PqvS4; PqvS4: if (!(!empty($p['query']) && 'hpp-regex' !== $p['query'])) { goto Ywhxd; } goto h2XrY; jESIr: Ywhxd: goto bVlbr; bVlbr: $headers = apply_filters('varnish_http_purge_headers', array('host' => $host_headers, 'X-Purge-Method' => $x_purge_method)); goto VB3Eq; RlwIb: if (!(isset($p['query']) && 'hpp-regex' === $p['query'])) { goto iIQVg; } goto OPEmh; J9hj3: do_action('after_purge_url', $parsed_url, $purgeme, $response, $headers); goto Xc5EU; ltiVi: if (isset($p['host'])) { goto ipKYV; } goto Wpgr7; VB3Eq: $response = wp_remote_request($purgeme, array('method' => 'PURGE', 'headers' => $headers)); goto J9hj3; SyKan: if (!isset($p['port'])) { goto csp1l; } goto qlcO1; h22q9: $host_headers = $p['host']; goto SyKan; iQ3GW: $x_purge_method = 'regex'; goto HqRe_; qlcO1: $host_headers .= ':' . $p['port']; goto DbJDR; Wpgr7: return; goto sCjb7; HqRe_: iIQVg: goto YoE2a; OQaHW: $parsed_url = $url; goto h22q9; XVOzc: $x_purge_method = 'default'; goto RlwIb; h2XrY: $purgeme .= '?' . $p['query']; goto jESIr; sCjb7: ipKYV: goto VF_cc; DbJDR: csp1l: goto UFRtA; YoE2a: $path = ''; goto fmMTA; I6vJT: $host = $p['host']; goto OQaHW; ge360: $p = wp_parse_url($url); goto ltiVi; yorhX: $schema = apply_filters('varnish_http_purge_schema', (isset($p['scheme']) ? $p['scheme'] : 'http') . '://'); goto I6vJT; OPEmh: $pregex = '.*'; goto iQ3GW; Xc5EU: } function purge_all($url) { goto lG82s; lG82s: $p = wp_parse_url($url); goto W9gbE; lKrf2: return $response; goto LkqB3; YLd2n: $response = wp_remote_request($purgeme, array('method' => 'CLEANFULLCACHE', 'headers' => array('host' => $p['host'] . (isset($p['port']) ? ':' . $p['port'] : '')))); goto lKrf2; W9gbE: if (isset($p['host'])) { goto uVnZt; } goto FaZdp; ZJVhy: uVnZt: goto DhehZ; FaZdp: return; goto ZJVhy; DhehZ: $schema = (isset($p['scheme']) ? $p['scheme'] : 'http') . '://'; goto Tzi6T; Tzi6T: $purgeme = $schema . $p['host']; goto YLd2n; LkqB3: } public function execute_purge() { goto cgwt6; xcsB_: if ('all' === $_GET['hpp_flush_do']) { goto UzV05; } goto cRJy5; AbZfM: if (isset($p['host'])) { goto gNzB4; } goto dUTPq; siCcb: $this->purge_all($this->the_home_url()); goto W1VHE; eYBLq: ghuqV: goto VzNIr; pgCA0: $this->purge_url(esc_url_raw(wp_unslash($_GET['hpp_flush_do']))); goto PhXJa; W1VHE: goto gSKHa; goto hjVHN; TSlMr: Br_Il: goto GKGng; F77L7: if ('object' === $_GET['hpp_flush_do']) { goto YFq24; } goto xcsB_; I21M_: if (empty($purge_urls) && isset($_GET)) { goto Br_Il; } goto JJ7LZ; LFgQj: YBsaC: goto siCcb; PhXJa: goto zf1lH; goto YGJRM; Xi56E: if (isset($_GET['hpp_flush_do']) && check_admin_referer('hpp-flush-do')) { goto ruyKr; } goto MGJ83; Lm2mh: gNzB4: goto pgCA0; oY8gS: zf1lH: goto dAefe; xuPY6: UzV05: goto JQGTP; dUTPq: return; goto Lm2mh; hjVHN: ruyKr: goto F77L7; JEKpc: fnXBZ: goto IA7VD; JQGTP: $this->purge_all($this->the_home_url()); goto oY8gS; E5ZGP: I0d5N: goto GLSIp; GKGng: if (isset($_GET['hpp_flush_all']) && check_admin_referer('hpp-flush-all')) { goto YBsaC; } goto Xi56E; cRJy5: $p = wp_parse_url(esc_url_raw(wp_unslash($_GET['hpp_flush_do']))); goto AbZfM; nTv0W: wp_cache_flush(); goto JEKpc; dAefe: gSKHa: goto eYBLq; gWi8s: if (!file_exists(WP_CONTENT_DIR . '/object-cache.php')) { goto fnXBZ; } goto nTv0W; JJ7LZ: foreach ($purge_urls as $url) { $this->purge_url($url); ZDBRY: } goto E5ZGP; YGJRM: YFq24: goto gWi8s; cgwt6: $purge_urls = array_unique($this->purge_urls); goto I21M_; IA7VD: goto zf1lH; goto xuPY6; GLSIp: goto ghuqV; goto TSlMr; MGJ83: goto gSKHa; goto LFgQj; VzNIr: } function exclude_pages_from_caching() { goto ysK9m; ceOnC: $seconds = 0; goto nO08h; nO08h: header("Expires: " . gmdate('D, d M Y H:i:s', time() + $seconds) . ' GMT'); goto lO9q8; KtkxY: return; goto IqxEG; VBy9M: if (!(!empty($post) and post_password_required($post->ID))) { goto dCzE2; } goto ceOnC; IqxEG: dCzE2: goto D57_g; ysK9m: global $post; goto VBy9M; lO9q8: header("Cache-Control: max-age=" . $seconds . ',private'); goto KtkxY; D57_g: } function opt_blog_public() { return hpp_if_access_hostv1() ? '0' : '1'; } } goto mKQae; Nyirv: VqASA: